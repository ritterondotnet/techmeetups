[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar Accounts = Package['accounts-base'].Accounts;\nvar AccountsServer = Package['accounts-base'].AccountsServer;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar _ = Package.underscore._;\nvar ReactiveVar = Package['reactive-var'].ReactiveVar;\nvar HTTP = Package.http.HTTP;\nvar HTTPInternals = Package.http.HTTPInternals;\n\n/* Package-scope variables */\nvar Field, STATE_PAT, ERRORS_PAT, INFO_PAT, INPUT_ICONS_PAT, ObjWithStringValues, TEXTS_PAT, CONFIG_PAT, FIELD_SUB_PAT, FIELD_PAT, AT, AccountsTemplates;\n\n(function(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// packages/useraccounts_core/lib/field.js                                                                     //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\n// ---------------------------------------------------------------------------------                           // 1\n// Field object                                                                                                // 2\n// ---------------------------------------------------------------------------------                           // 3\n                                                                                                               // 4\nField = function(field) {                                                                                      // 5\n  check(field, FIELD_PAT);                                                                                     // 6\n  _.defaults(this, field);                                                                                     // 7\n                                                                                                               // 8\n  this.validating = new ReactiveVar(false);                                                                    // 9\n  this.status = new ReactiveVar(null);                                                                         // 10\n};                                                                                                             // 11\n                                                                                                               // 12\nif (Meteor.isClient) {                                                                                         // 13\n  Field.prototype.clearStatus = function() {                                                                   // 14\n    return this.status.set(null);                                                                              // 15\n  };                                                                                                           // 16\n}                                                                                                              // 17\n                                                                                                               // 18\nif (Meteor.isServer) {                                                                                         // 19\n  Field.prototype.clearStatus = function() {                                                                   // 20\n    // Nothing to do server-side                                                                               // 21\n    return;                                                                                                    // 22\n  };                                                                                                           // 23\n}                                                                                                              // 24\n                                                                                                               // 25\nField.prototype.fixValue = function(value) {                                                                   // 26\n  if (this.type === \"checkbox\") {                                                                              // 27\n    return !!value;                                                                                            // 28\n  }                                                                                                            // 29\n                                                                                                               // 30\n  if (this.type === \"select\") {                                                                                // 31\n    // TODO: something working...                                                                              // 32\n    return value;                                                                                              // 33\n  }                                                                                                            // 34\n                                                                                                               // 35\n  if (this.type === \"radio\") {                                                                                 // 36\n    // TODO: something working...                                                                              // 37\n    return value;                                                                                              // 38\n  }                                                                                                            // 39\n                                                                                                               // 40\n  // Possibly applies required transformations to the input value                                              // 41\n  if (this.trim) {                                                                                             // 42\n    value = value.trim();                                                                                      // 43\n  }                                                                                                            // 44\n                                                                                                               // 45\n  if (this.lowercase) {                                                                                        // 46\n    value = value.toLowerCase();                                                                               // 47\n  }                                                                                                            // 48\n                                                                                                               // 49\n  if (this.uppercase) {                                                                                        // 50\n    value = value.toUpperCase();                                                                               // 51\n  }                                                                                                            // 52\n                                                                                                               // 53\n  if (!!this.transform) {                                                                                      // 54\n    value = this.transform(value);                                                                             // 55\n  }                                                                                                            // 56\n                                                                                                               // 57\n  return value;                                                                                                // 58\n};                                                                                                             // 59\n                                                                                                               // 60\nif (Meteor.isClient) {                                                                                         // 61\n  Field.prototype.getDisplayName = function(state) {                                                           // 62\n    var displayName = this.displayName;                                                                        // 63\n                                                                                                               // 64\n    if (_.isFunction(displayName)) {                                                                           // 65\n      displayName = displayName();                                                                             // 66\n    } else if (_.isObject(displayName)) {                                                                      // 67\n      displayName = displayName[state] || displayName[\"default\"];                                              // 68\n    }                                                                                                          // 69\n                                                                                                               // 70\n    if (!displayName) {                                                                                        // 71\n      displayName = capitalize(this._id);                                                                      // 72\n    }                                                                                                          // 73\n                                                                                                               // 74\n    return displayName;                                                                                        // 75\n  };                                                                                                           // 76\n}                                                                                                              // 77\n                                                                                                               // 78\nif (Meteor.isClient) {                                                                                         // 79\n  Field.prototype.getPlaceholder = function(state) {                                                           // 80\n    var placeholder = this.placeholder;                                                                        // 81\n                                                                                                               // 82\n    if (_.isObject(placeholder)) {                                                                             // 83\n      placeholder = placeholder[state] || placeholder[\"default\"];                                              // 84\n    }                                                                                                          // 85\n                                                                                                               // 86\n    if (!placeholder) {                                                                                        // 87\n      placeholder = capitalize(this._id);                                                                      // 88\n    }                                                                                                          // 89\n                                                                                                               // 90\n    return placeholder;                                                                                        // 91\n  };                                                                                                           // 92\n}                                                                                                              // 93\n                                                                                                               // 94\nField.prototype.getStatus = function() {                                                                       // 95\n  return this.status.get();                                                                                    // 96\n};                                                                                                             // 97\n                                                                                                               // 98\nif (Meteor.isClient) {                                                                                         // 99\n  Field.prototype.getValue = function(tempalteInstance) {                                                      // 100\n    if (this.type === \"checkbox\") {                                                                            // 101\n      return !!(tempalteInstance.$(\"#at-field-\" + this._id + \":checked\").val());                               // 102\n    }                                                                                                          // 103\n                                                                                                               // 104\n    if (this.type === \"radio\") {                                                                               // 105\n      return tempalteInstance.$(\"[name=at-field-\"+ this._id + \"]:checked\").val();                              // 106\n    }                                                                                                          // 107\n                                                                                                               // 108\n    return tempalteInstance.$(\"#at-field-\" + this._id).val();                                                  // 109\n  };                                                                                                           // 110\n}                                                                                                              // 111\n                                                                                                               // 112\nif (Meteor.isClient) {                                                                                         // 113\n  Field.prototype.hasError = function() {                                                                      // 114\n    return this.negativeValidation && this.status.get();                                                       // 115\n  };                                                                                                           // 116\n}                                                                                                              // 117\n                                                                                                               // 118\nif (Meteor.isClient) {                                                                                         // 119\n  Field.prototype.hasIcon = function() {                                                                       // 120\n    if (this.showValidating && this.isValidating()) {                                                          // 121\n      return true;                                                                                             // 122\n    }                                                                                                          // 123\n                                                                                                               // 124\n    if (this.negativeFeedback && this.hasError()) {                                                            // 125\n      return true;                                                                                             // 126\n    }                                                                                                          // 127\n                                                                                                               // 128\n    if (this.positiveFeedback && this.hasSuccess()) {                                                          // 129\n      return true;                                                                                             // 130\n    }                                                                                                          // 131\n  };                                                                                                           // 132\n}                                                                                                              // 133\n                                                                                                               // 134\nif (Meteor.isClient) {                                                                                         // 135\n  Field.prototype.hasSuccess = function() {                                                                    // 136\n    return this.positiveValidation && this.status.get() === false;                                             // 137\n  };                                                                                                           // 138\n}                                                                                                              // 139\n                                                                                                               // 140\nif (Meteor.isClient)                                                                                           // 141\n  Field.prototype.iconClass = function() {                                                                     // 142\n    if (this.isValidating()) {                                                                                 // 143\n      return AccountsTemplates.texts.inputIcons[\"isValidating\"];                                               // 144\n    }                                                                                                          // 145\n                                                                                                               // 146\n    if (this.hasError()) {                                                                                     // 147\n      return AccountsTemplates.texts.inputIcons[\"hasError\"];                                                   // 148\n    }                                                                                                          // 149\n                                                                                                               // 150\n    if (this.hasSuccess()) {                                                                                   // 151\n      return AccountsTemplates.texts.inputIcons[\"hasSuccess\"];                                                 // 152\n    }                                                                                                          // 153\n  };                                                                                                           // 154\n                                                                                                               // 155\nif (Meteor.isClient) {                                                                                         // 156\n  Field.prototype.isValidating = function() {                                                                  // 157\n    return this.validating.get();                                                                              // 158\n  };                                                                                                           // 159\n}                                                                                                              // 160\n                                                                                                               // 161\nif (Meteor.isClient) {                                                                                         // 162\n  Field.prototype.setError = function(err) {                                                                   // 163\n    check(err, Match.OneOf(String, undefined, Boolean));                                                       // 164\n                                                                                                               // 165\n    if (err === false) {                                                                                       // 166\n      return this.status.set(false);                                                                           // 167\n    }                                                                                                          // 168\n                                                                                                               // 169\n    return this.status.set(err || true);                                                                       // 170\n  };                                                                                                           // 171\n}                                                                                                              // 172\n                                                                                                               // 173\nif (Meteor.isServer) {                                                                                         // 174\n  Field.prototype.setError = function(err) {                                                                   // 175\n    // Nothing to do server-side                                                                               // 176\n    return;                                                                                                    // 177\n  };                                                                                                           // 178\n}                                                                                                              // 179\n                                                                                                               // 180\nif (Meteor.isClient) {                                                                                         // 181\n  Field.prototype.setSuccess = function() {                                                                    // 182\n    return this.status.set(false);                                                                             // 183\n  };                                                                                                           // 184\n}                                                                                                              // 185\n                                                                                                               // 186\nif (Meteor.isServer) {                                                                                         // 187\n  Field.prototype.setSuccess = function() {                                                                    // 188\n    // Nothing to do server-side                                                                               // 189\n    return;                                                                                                    // 190\n  };                                                                                                           // 191\n}                                                                                                              // 192\n                                                                                                               // 193\nif (Meteor.isClient) {                                                                                         // 194\n  Field.prototype.setValidating = function(state) {                                                            // 195\n    check(state, Boolean);                                                                                     // 196\n    return this.validating.set(state);                                                                         // 197\n  };                                                                                                           // 198\n}                                                                                                              // 199\n                                                                                                               // 200\nif (Meteor.isServer) {                                                                                         // 201\n  Field.prototype.setValidating = function(state) {                                                            // 202\n    // Nothing to do server-side                                                                               // 203\n    return;                                                                                                    // 204\n  };                                                                                                           // 205\n}                                                                                                              // 206\n                                                                                                               // 207\nif (Meteor.isClient) {                                                                                         // 208\n  Field.prototype.setValue = function(tempalteInstance, value) {                                               // 209\n    if (this.type === \"checkbox\") {                                                                            // 210\n      tempalteInstance.$(\"#at-field-\" + this._id).prop('checked', true);                                       // 211\n      return;                                                                                                  // 212\n    }                                                                                                          // 213\n                                                                                                               // 214\n    if (this.type === \"radio\") {                                                                               // 215\n      tempalteInstance.$(\"[name=at-field-\"+ this._id + \"]\").prop('checked', true);                             // 216\n      return;                                                                                                  // 217\n    }                                                                                                          // 218\n                                                                                                               // 219\n    tempalteInstance.$(\"#at-field-\" + this._id).val(value);                                                    // 220\n  };                                                                                                           // 221\n}                                                                                                              // 222\n                                                                                                               // 223\nField.prototype.validate = function(value, strict) {                                                           // 224\n  check(value, Match.OneOf(undefined, String, Boolean));                                                       // 225\n  this.setValidating(true);                                                                                    // 226\n  this.clearStatus();                                                                                          // 227\n                                                                                                               // 228\n  if (_.isUndefined(value) || value === '') {                                                                  // 229\n    if (!!strict) {                                                                                            // 230\n      if (this.required) {                                                                                     // 231\n        this.setError(AccountsTemplates.texts.requiredField);                                                  // 232\n        this.setValidating(false);                                                                             // 233\n                                                                                                               // 234\n        return AccountsTemplates.texts.requiredField;                                                          // 235\n      } else {                                                                                                 // 236\n        this.setSuccess();                                                                                     // 237\n        this.setValidating(false);                                                                             // 238\n                                                                                                               // 239\n        return false;                                                                                          // 240\n      }                                                                                                        // 241\n    } else {                                                                                                   // 242\n      this.clearStatus();                                                                                      // 243\n      this.setValidating(false);                                                                               // 244\n                                                                                                               // 245\n      return null;                                                                                             // 246\n    }                                                                                                          // 247\n  }                                                                                                            // 248\n                                                                                                               // 249\n  var valueLength = value.length;                                                                              // 250\n  var minLength = this.minLength;                                                                              // 251\n  if (minLength && valueLength < minLength) {                                                                  // 252\n    this.setError(AccountsTemplates.texts.minRequiredLength + \": \" + minLength);                               // 253\n    this.setValidating(false);                                                                                 // 254\n                                                                                                               // 255\n    return AccountsTemplates.texts.minRequiredLength + \": \" + minLength;                                       // 256\n  }                                                                                                            // 257\n                                                                                                               // 258\n  var maxLength = this.maxLength;                                                                              // 259\n  if (maxLength && valueLength > maxLength) {                                                                  // 260\n    this.setError(AccountsTemplates.texts.maxAllowedLength + \": \" + maxLength);                                // 261\n    this.setValidating(false);                                                                                 // 262\n                                                                                                               // 263\n    return AccountsTemplates.texts.maxAllowedLength + \": \" + maxLength;                                        // 264\n  }                                                                                                            // 265\n                                                                                                               // 266\n  if (this.re && valueLength && !value.match(this.re)) {                                                       // 267\n    this.setError(this.errStr);                                                                                // 268\n    this.setValidating(false);                                                                                 // 269\n                                                                                                               // 270\n    return this.errStr;                                                                                        // 271\n  }                                                                                                            // 272\n                                                                                                               // 273\n  if (this.func) {                                                                                             // 274\n    var result = this.func(value);                                                                             // 275\n    var err = result === true ? this.errStr || true : result;                                                  // 276\n                                                                                                               // 277\n    if (_.isUndefined(result)) {                                                                               // 278\n      return err;                                                                                              // 279\n    }                                                                                                          // 280\n                                                                                                               // 281\n    this.status.set(err);                                                                                      // 282\n    this.setValidating(false);                                                                                 // 283\n                                                                                                               // 284\n    return err;                                                                                                // 285\n  }                                                                                                            // 286\n                                                                                                               // 287\n  this.setSuccess();                                                                                           // 288\n  this.setValidating(false);                                                                                   // 289\n                                                                                                               // 290\n  return false;                                                                                                // 291\n};                                                                                                             // 292\n                                                                                                               // 293\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// packages/useraccounts_core/lib/core.js                                                                      //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\n// ---------------------------------------------------------------------------------                           // 1\n// Patterns for methods\" parameters                                                                            // 2\n// ---------------------------------------------------------------------------------                           // 3\n                                                                                                               // 4\nSTATE_PAT = {                                                                                                  // 5\n  changePwd: Match.Optional(String),                                                                           // 6\n  enrollAccount: Match.Optional(String),                                                                       // 7\n  forgotPwd: Match.Optional(String),                                                                           // 8\n  resetPwd: Match.Optional(String),                                                                            // 9\n  signIn: Match.Optional(String),                                                                              // 10\n  signUp: Match.Optional(String),                                                                              // 11\n  verifyEmail: Match.Optional(String),                                                                         // 12\n  resendVerificationEmail: Match.Optional(String),                                                             // 13\n};                                                                                                             // 14\n                                                                                                               // 15\nERRORS_PAT = {                                                                                                 // 16\n  accountsCreationDisabled: Match.Optional(String),                                                            // 17\n  cannotRemoveService: Match.Optional(String),                                                                 // 18\n  captchaVerification: Match.Optional(String),                                                                 // 19\n  loginForbidden: Match.Optional(String),                                                                      // 20\n  mustBeLoggedIn: Match.Optional(String),                                                                      // 21\n  pwdMismatch: Match.Optional(String),                                                                         // 22\n  validationErrors: Match.Optional(String),                                                                    // 23\n  verifyEmailFirst: Match.Optional(String),                                                                    // 24\n};                                                                                                             // 25\n                                                                                                               // 26\nINFO_PAT = {                                                                                                   // 27\n  emailSent: Match.Optional(String),                                                                           // 28\n  emailVerified: Match.Optional(String),                                                                       // 29\n  pwdChanged: Match.Optional(String),                                                                          // 30\n  pwdReset: Match.Optional(String),                                                                            // 31\n  pwdSet: Match.Optional(String),                                                                              // 32\n  signUpVerifyEmail: Match.Optional(String),                                                                   // 33\n  verificationEmailSent: Match.Optional(String),                                                               // 34\n};                                                                                                             // 35\n                                                                                                               // 36\nINPUT_ICONS_PAT = {                                                                                            // 37\n  hasError: Match.Optional(String),                                                                            // 38\n  hasSuccess: Match.Optional(String),                                                                          // 39\n  isValidating: Match.Optional(String),                                                                        // 40\n};                                                                                                             // 41\n                                                                                                               // 42\nObjWithStringValues = Match.Where(function (x) {                                                               // 43\n  check(x, Object);                                                                                            // 44\n  _.each(_.values(x), function(value) {                                                                        // 45\n      check(value, String);                                                                                    // 46\n  });                                                                                                          // 47\n  return true;                                                                                                 // 48\n});                                                                                                            // 49\n                                                                                                               // 50\nTEXTS_PAT = {                                                                                                  // 51\n  button: Match.Optional(STATE_PAT),                                                                           // 52\n  errors: Match.Optional(ERRORS_PAT),                                                                          // 53\n  info: Match.Optional(INFO_PAT),                                                                              // 54\n  inputIcons: Match.Optional(INPUT_ICONS_PAT),                                                                 // 55\n  maxAllowedLength: Match.Optional(String),                                                                    // 56\n  minRequiredLength: Match.Optional(String),                                                                   // 57\n  navSignIn: Match.Optional(String),                                                                           // 58\n  navSignOut: Match.Optional(String),                                                                          // 59\n  optionalField: Match.Optional(String),                                                                       // 60\n  pwdLink_link: Match.Optional(String),                                                                        // 61\n  pwdLink_pre: Match.Optional(String),                                                                         // 62\n  pwdLink_suff: Match.Optional(String),                                                                        // 63\n  requiredField: Match.Optional(String),                                                                       // 64\n  resendVerificationEmailLink_pre: Match.Optional(String),                                                     // 65\n  resendVerificationEmailLink_link: Match.Optional(String),                                                    // 66\n  resendVerificationEmailLink_suff: Match.Optional(String),                                                    // 67\n  sep: Match.Optional(String),                                                                                 // 68\n  signInLink_link: Match.Optional(String),                                                                     // 69\n  signInLink_pre: Match.Optional(String),                                                                      // 70\n  signInLink_suff: Match.Optional(String),                                                                     // 71\n  signUpLink_link: Match.Optional(String),                                                                     // 72\n  signUpLink_pre: Match.Optional(String),                                                                      // 73\n  signUpLink_suff: Match.Optional(String),                                                                     // 74\n  socialAdd: Match.Optional(String),                                                                           // 75\n  socialConfigure: Match.Optional(String),                                                                     // 76\n  socialIcons: Match.Optional(ObjWithStringValues),                                                            // 77\n  socialRemove: Match.Optional(String),                                                                        // 78\n  socialSignIn: Match.Optional(String),                                                                        // 79\n  socialSignUp: Match.Optional(String),                                                                        // 80\n  socialWith: Match.Optional(String),                                                                          // 81\n  termsAnd: Match.Optional(String),                                                                            // 82\n  termsPreamble: Match.Optional(String),                                                                       // 83\n  termsPrivacy: Match.Optional(String),                                                                        // 84\n  termsTerms: Match.Optional(String),                                                                          // 85\n  title: Match.Optional(STATE_PAT),                                                                            // 86\n};                                                                                                             // 87\n                                                                                                               // 88\n// Configuration pattern to be checked with check                                                              // 89\nCONFIG_PAT = {                                                                                                 // 90\n  // Behaviour                                                                                                 // 91\n  confirmPassword: Match.Optional(Boolean),                                                                    // 92\n  defaultState: Match.Optional(String),                                                                        // 93\n  enablePasswordChange: Match.Optional(Boolean),                                                               // 94\n  enforceEmailVerification: Match.Optional(Boolean),                                                           // 95\n  focusFirstInput: Match.Optional(Boolean),                                                                    // 96\n  forbidClientAccountCreation: Match.Optional(Boolean),                                                        // 97\n  lowercaseUsername: Match.Optional(Boolean),                                                                  // 98\n  overrideLoginErrors: Match.Optional(Boolean),                                                                // 99\n  sendVerificationEmail: Match.Optional(Boolean),                                                              // 100\n  socialLoginStyle: Match.Optional(Match.OneOf(\"popup\", \"redirect\")),                                          // 101\n                                                                                                               // 102\n  // Appearance                                                                                                // 103\n  defaultLayout: Match.Optional(String),                                                                       // 104\n  hideSignInLink: Match.Optional(Boolean),                                                                     // 105\n  hideSignUpLink: Match.Optional(Boolean),                                                                     // 106\n  showAddRemoveServices: Match.Optional(Boolean),                                                              // 107\n  showForgotPasswordLink: Match.Optional(Boolean),                                                             // 108\n  showResendVerificationEmailLink: Match.Optional(Boolean),                                                    // 109\n  showLabels: Match.Optional(Boolean),                                                                         // 110\n  showPlaceholders: Match.Optional(Boolean),                                                                   // 111\n                                                                                                               // 112\n  // Client-side Validation                                                                                    // 113\n  continuousValidation: Match.Optional(Boolean),                                                               // 114\n  negativeFeedback: Match.Optional(Boolean),                                                                   // 115\n  negativeValidation: Match.Optional(Boolean),                                                                 // 116\n  positiveFeedback: Match.Optional(Boolean),                                                                   // 117\n  positiveValidation: Match.Optional(Boolean),                                                                 // 118\n  showValidating: Match.Optional(Boolean),                                                                     // 119\n                                                                                                               // 120\n  // Privacy Policy and Terms of Use                                                                           // 121\n  privacyUrl: Match.Optional(String),                                                                          // 122\n  termsUrl: Match.Optional(String),                                                                            // 123\n                                                                                                               // 124\n  // Redirects                                                                                                 // 125\n  homeRoutePath: Match.Optional(String),                                                                       // 126\n  redirectTimeout: Match.Optional(Number),                                                                     // 127\n                                                                                                               // 128\n  // Hooks                                                                                                     // 129\n  onLogoutHook: Match.Optional(Function),                                                                      // 130\n  onSubmitHook: Match.Optional(Function),                                                                      // 131\n  preSignUpHook: Match.Optional(Function),                                                                     // 132\n  postSignUpHook: Match.Optional(Function),                                                                    // 133\n                                                                                                               // 134\n  texts: Match.Optional(TEXTS_PAT),                                                                            // 135\n                                                                                                               // 136\n  //reCaptcha config                                                                                           // 137\n  reCaptcha: Match.Optional({                                                                                  // 138\n    data_type: Match.Optional(Match.OneOf(\"audio\", \"image\")),                                                  // 139\n    secretKey: Match.Optional(String),                                                                         // 140\n    siteKey: Match.Optional(String),                                                                           // 141\n    theme: Match.Optional(Match.OneOf(\"dark\", \"light\")),                                                       // 142\n  }),                                                                                                          // 143\n                                                                                                               // 144\n  showReCaptcha: Match.Optional(Boolean),                                                                      // 145\n};                                                                                                             // 146\n                                                                                                               // 147\n                                                                                                               // 148\nFIELD_SUB_PAT = {                                                                                              // 149\n  \"default\": Match.Optional(String),                                                                           // 150\n  changePwd: Match.Optional(String),                                                                           // 151\n  enrollAccount: Match.Optional(String),                                                                       // 152\n  forgotPwd: Match.Optional(String),                                                                           // 153\n  resetPwd: Match.Optional(String),                                                                            // 154\n  signIn: Match.Optional(String),                                                                              // 155\n  signUp: Match.Optional(String),                                                                              // 156\n};                                                                                                             // 157\n                                                                                                               // 158\n                                                                                                               // 159\n// Field pattern                                                                                               // 160\nFIELD_PAT = {                                                                                                  // 161\n  _id: String,                                                                                                 // 162\n  type: String,                                                                                                // 163\n  required: Match.Optional(Boolean),                                                                           // 164\n  displayName: Match.Optional(Match.OneOf(String, Match.Where(_.isFunction), FIELD_SUB_PAT)),                  // 165\n  placeholder: Match.Optional(Match.OneOf(String, FIELD_SUB_PAT)),                                             // 166\n  select: Match.Optional([{text: String, value: Match.Any}]),                                                  // 167\n  minLength: Match.Optional(Match.Integer),                                                                    // 168\n  maxLength: Match.Optional(Match.Integer),                                                                    // 169\n  re: Match.Optional(RegExp),                                                                                  // 170\n  func: Match.Optional(Match.Where(_.isFunction)),                                                             // 171\n  errStr: Match.Optional(String),                                                                              // 172\n                                                                                                               // 173\n  // Client-side Validation                                                                                    // 174\n  continuousValidation: Match.Optional(Boolean),                                                               // 175\n  negativeFeedback: Match.Optional(Boolean),                                                                   // 176\n  negativeValidation: Match.Optional(Boolean),                                                                 // 177\n  positiveValidation: Match.Optional(Boolean),                                                                 // 178\n  positiveFeedback: Match.Optional(Boolean),                                                                   // 179\n                                                                                                               // 180\n  // Transforms                                                                                                // 181\n  trim: Match.Optional(Boolean),                                                                               // 182\n  lowercase: Match.Optional(Boolean),                                                                          // 183\n  uppercase: Match.Optional(Boolean),                                                                          // 184\n  transform: Match.Optional(Match.Where(_.isFunction)),                                                        // 185\n                                                                                                               // 186\n  // Custom options                                                                                            // 187\n  options: Match.Optional(Object),                                                                             // 188\n  template: Match.Optional(String),                                                                            // 189\n};                                                                                                             // 190\n                                                                                                               // 191\n// -----------------------------------------------------------------------------                               // 192\n// AccountsTemplates object                                                                                    // 193\n// -----------------------------------------------------------------------------                               // 194\n                                                                                                               // 195\n// -------------------                                                                                         // 196\n// Client/Server stuff                                                                                         // 197\n// -------------------                                                                                         // 198\n                                                                                                               // 199\n// Constructor                                                                                                 // 200\nAT = function() {                                                                                              // 201\n                                                                                                               // 202\n};                                                                                                             // 203\n                                                                                                               // 204\nAT.prototype.CONFIG_PAT = CONFIG_PAT;                                                                          // 205\n                                                                                                               // 206\n/*                                                                                                             // 207\n  Each field object is represented by the following properties:                                                // 208\n    _id:         String   (required)  // A unique field\"s id / name                                            // 209\n    type:        String   (required)  // Displayed input type                                                  // 210\n    required:    Boolean  (optional)  // Specifies Whether to fail or not when field is left empty             // 211\n    displayName: String   (optional)  // The field\"s name to be displayed as a label above the input element   // 212\n    placeholder: String   (optional)  // The placeholder text to be displayed inside the input element         // 213\n    minLength:   Integer  (optional)  // Possibly specifies the minimum allowed length                         // 214\n    maxLength:   Integer  (optional)  // Possibly specifies the maximum allowed length                         // 215\n    re:          RegExp   (optional)  // Regular expression for validation                                     // 216\n    func:        Function (optional)  // Custom function for validation                                        // 217\n    errStr:      String   (optional)  // Error message to be displayed in case re validation fails             // 218\n*/                                                                                                             // 219\n                                                                                                               // 220\n                                                                                                               // 221\n// Allowed input types                                                                                         // 222\nAT.prototype.INPUT_TYPES = [                                                                                   // 223\n  \"checkbox\",                                                                                                  // 224\n  \"email\",                                                                                                     // 225\n  \"hidden\",                                                                                                    // 226\n  \"password\",                                                                                                  // 227\n  \"radio\",                                                                                                     // 228\n  \"select\",                                                                                                    // 229\n  \"tel\",                                                                                                       // 230\n  \"text\",                                                                                                      // 231\n  \"url\",                                                                                                       // 232\n];                                                                                                             // 233\n                                                                                                               // 234\n// Current configuration values                                                                                // 235\nAT.prototype.options = {                                                                                       // 236\n  // Appearance                                                                                                // 237\n  //defaultLayout: undefined,                                                                                  // 238\n  showAddRemoveServices: false,                                                                                // 239\n  showForgotPasswordLink: false,                                                                               // 240\n  showResendVerificationEmailLink: false,                                                                      // 241\n  showLabels: true,                                                                                            // 242\n  showPlaceholders: true,                                                                                      // 243\n                                                                                                               // 244\n  // Behaviour                                                                                                 // 245\n  confirmPassword: true,                                                                                       // 246\n  defaultState: \"signIn\",                                                                                      // 247\n  enablePasswordChange: false,                                                                                 // 248\n  focusFirstInput: !Meteor.isCordova,                                                                          // 249\n  forbidClientAccountCreation: false,                                                                          // 250\n  lowercaseUsername: false,                                                                                    // 251\n  overrideLoginErrors: true,                                                                                   // 252\n  sendVerificationEmail: false,                                                                                // 253\n  socialLoginStyle: \"popup\",                                                                                   // 254\n                                                                                                               // 255\n  // Client-side Validation                                                                                    // 256\n  //continuousValidation: false,                                                                               // 257\n  //negativeFeedback: false,                                                                                   // 258\n  //negativeValidation: false,                                                                                 // 259\n  //positiveValidation: false,                                                                                 // 260\n  //positiveFeedback: false,                                                                                   // 261\n  //showValidating: false,                                                                                     // 262\n                                                                                                               // 263\n  // Privacy Policy and Terms of Use                                                                           // 264\n  privacyUrl: undefined,                                                                                       // 265\n  termsUrl: undefined,                                                                                         // 266\n                                                                                                               // 267\n  // Hooks                                                                                                     // 268\n  onSubmitHook: undefined,                                                                                     // 269\n};                                                                                                             // 270\n                                                                                                               // 271\nAT.prototype.texts = {                                                                                         // 272\n  button: {                                                                                                    // 273\n    changePwd: \"updateYourPassword\",                                                                           // 274\n    //enrollAccount: \"createAccount\",                                                                          // 275\n    enrollAccount: \"signUp\",                                                                                   // 276\n    forgotPwd: \"emailResetLink\",                                                                               // 277\n    resetPwd: \"setPassword\",                                                                                   // 278\n    signIn: \"signIn\",                                                                                          // 279\n    signUp: \"signUp\",                                                                                          // 280\n    resendVerificationEmail: \"Send email again\",                                                               // 281\n  },                                                                                                           // 282\n  errors: {                                                                                                    // 283\n    accountsCreationDisabled: \"Client side accounts creation is disabled!!!\",                                  // 284\n    cannotRemoveService: \"Cannot remove the only active service!\",                                             // 285\n    captchaVerification: \"Captcha verification failed!\",                                                       // 286\n    loginForbidden: \"error.accounts.Login forbidden\",                                                          // 287\n    mustBeLoggedIn: \"error.accounts.Must be logged in\",                                                        // 288\n    pwdMismatch: \"error.pwdsDontMatch\",                                                                        // 289\n    validationErrors: \"Validation Errors\",                                                                     // 290\n    verifyEmailFirst: \"Please verify your email first. Check the email and follow the link!\",                  // 291\n  },                                                                                                           // 292\n  navSignIn: 'signIn',                                                                                         // 293\n  navSignOut: 'signOut',                                                                                       // 294\n  info: {                                                                                                      // 295\n    emailSent: \"info.emailSent\",                                                                               // 296\n    emailVerified: \"info.emailVerified\",                                                                       // 297\n    pwdChanged: \"info.passwordChanged\",                                                                        // 298\n    pwdReset: \"info.passwordReset\",                                                                            // 299\n    pwdSet: \"Password Set\",                                                                                    // 300\n    signUpVerifyEmail: \"Successful Registration! Please check your email and follow the instructions.\",        // 301\n    verificationEmailSent: \"A new email has been sent to you. If the email doesn't show up in your inbox, be sure to check your spam folder.\",\n  },                                                                                                           // 303\n  inputIcons: {                                                                                                // 304\n    isValidating: \"fa fa-spinner fa-spin\",                                                                     // 305\n    hasSuccess: \"fa fa-check\",                                                                                 // 306\n    hasError: \"fa fa-times\",                                                                                   // 307\n  },                                                                                                           // 308\n  maxAllowedLength: \"Maximum allowed length\",                                                                  // 309\n  minRequiredLength: \"Minimum required length\",                                                                // 310\n  optionalField: \"optional\",                                                                                   // 311\n  pwdLink_pre: \"\",                                                                                             // 312\n  pwdLink_link: \"forgotPassword\",                                                                              // 313\n  pwdLink_suff: \"\",                                                                                            // 314\n  requiredField: \"Required Field\",                                                                             // 315\n  resendVerificationEmailLink_pre: \"Verification email lost?\",                                                 // 316\n  resendVerificationEmailLink_link: \"Send again\",                                                              // 317\n  resendVerificationEmailLink_suff: \"\",                                                                        // 318\n  sep: \"OR\",                                                                                                   // 319\n  signInLink_pre: \"ifYouAlreadyHaveAnAccount\",                                                                 // 320\n  signInLink_link: \"signin\",                                                                                   // 321\n  signInLink_suff: \"\",                                                                                         // 322\n  signUpLink_pre: \"dontHaveAnAccount\",                                                                         // 323\n  signUpLink_link: \"signUp\",                                                                                   // 324\n  signUpLink_suff: \"\",                                                                                         // 325\n  socialAdd: \"add\",                                                                                            // 326\n  socialConfigure: \"configure\",                                                                                // 327\n  socialIcons: {                                                                                               // 328\n      \"meteor-developer\": \"fa fa-rocket\"                                                                       // 329\n  },                                                                                                           // 330\n  socialRemove: \"remove\",                                                                                      // 331\n  socialSignIn: \"signIn\",                                                                                      // 332\n  socialSignUp: \"signUp\",                                                                                      // 333\n  socialWith: \"with\",                                                                                          // 334\n  termsPreamble: \"clickAgree\",                                                                                 // 335\n  termsPrivacy: \"privacyPolicy\",                                                                               // 336\n  termsAnd: \"and\",                                                                                             // 337\n  termsTerms: \"terms\",                                                                                         // 338\n  title: {                                                                                                     // 339\n    changePwd: \"changePassword\",                                                                               // 340\n    enrollAccount: \"createAccount\",                                                                            // 341\n    forgotPwd: \"resetYourPassword\",                                                                            // 342\n    resetPwd: \"resetYourPassword\",                                                                             // 343\n    signIn: \"signIn\",                                                                                          // 344\n    signUp: \"createAccount\",                                                                                   // 345\n    verifyEmail: \"\",                                                                                           // 346\n    resendVerificationEmail: \"Send the verification email again\",                                              // 347\n  },                                                                                                           // 348\n};                                                                                                             // 349\n                                                                                                               // 350\nAT.prototype.SPECIAL_FIELDS = [                                                                                // 351\n  \"password_again\",                                                                                            // 352\n  \"username_and_email\",                                                                                        // 353\n];                                                                                                             // 354\n                                                                                                               // 355\n// SignIn / SignUp fields                                                                                      // 356\nAT.prototype._fields = [                                                                                       // 357\n  new Field({                                                                                                  // 358\n    _id: \"email\",                                                                                              // 359\n    type: \"email\",                                                                                             // 360\n    required: true,                                                                                            // 361\n    lowercase: true,                                                                                           // 362\n    trim: true,                                                                                                // 363\n    func: function(email) {                                                                                    // 364\n        return !_.contains(email, '@');                                                                        // 365\n    },                                                                                                         // 366\n    errStr: 'Invalid email',                                                                                   // 367\n  }),                                                                                                          // 368\n  new Field({                                                                                                  // 369\n    _id: \"password\",                                                                                           // 370\n    type: \"password\",                                                                                          // 371\n    required: true,                                                                                            // 372\n    minLength: 6,                                                                                              // 373\n    displayName: {                                                                                             // 374\n        \"default\": \"password\",                                                                                 // 375\n        changePwd: \"newPassword\",                                                                              // 376\n        resetPwd: \"newPassword\",                                                                               // 377\n    },                                                                                                         // 378\n    placeholder: {                                                                                             // 379\n        \"default\": \"password\",                                                                                 // 380\n        changePwd: \"newPassword\",                                                                              // 381\n        resetPwd: \"newPassword\",                                                                               // 382\n    },                                                                                                         // 383\n  }),                                                                                                          // 384\n];                                                                                                             // 385\n                                                                                                               // 386\n                                                                                                               // 387\nAT.prototype._initialized = false;                                                                             // 388\n                                                                                                               // 389\n// Input type validation                                                                                       // 390\nAT.prototype._isValidInputType = function(value) {                                                             // 391\n    return _.indexOf(this.INPUT_TYPES, value) !== -1;                                                          // 392\n};                                                                                                             // 393\n                                                                                                               // 394\nAT.prototype.addField = function(field) {                                                                      // 395\n    // Fields can be added only before initialization                                                          // 396\n    if (this._initialized) {                                                                                   // 397\n      throw new Error(\"AccountsTemplates.addField should strictly be called before AccountsTemplates.init!\");  // 398\n    }                                                                                                          // 399\n                                                                                                               // 400\n    field = _.pick(field, _.keys(FIELD_PAT));                                                                  // 401\n    check(field, FIELD_PAT);                                                                                   // 402\n    // Checks there\"s currently no field called field._id                                                      // 403\n    if (_.indexOf(_.pluck(this._fields, \"_id\"), field._id) !== -1) {                                           // 404\n      throw new Error(\"A field called \" + field._id + \" already exists!\");                                     // 405\n    }                                                                                                          // 406\n    // Validates field.type                                                                                    // 407\n    if (!this._isValidInputType(field.type)) {                                                                 // 408\n      throw new Error(\"field.type is not valid!\");                                                             // 409\n    }                                                                                                          // 410\n    // Checks field.minLength is strictly positive                                                             // 411\n    if (typeof field.minLength !== \"undefined\" && field.minLength <= 0) {                                      // 412\n      throw new Error(\"field.minLength should be greater than zero!\");                                         // 413\n    }                                                                                                          // 414\n    // Checks field.maxLength is strictly positive                                                             // 415\n    if (typeof field.maxLength !== \"undefined\" && field.maxLength <= 0) {                                      // 416\n      throw new Error(\"field.maxLength should be greater than zero!\");                                         // 417\n    }                                                                                                          // 418\n    // Checks field.maxLength is greater than field.minLength                                                  // 419\n    if (typeof field.minLength !== \"undefined\" && typeof field.minLength !== \"undefined\" && field.maxLength < field.minLength) {\n      throw new Error(\"field.maxLength should be greater than field.maxLength!\");                              // 421\n    }                                                                                                          // 422\n                                                                                                               // 423\n    if (!(Meteor.isServer && _.contains(this.SPECIAL_FIELDS, field._id))) {                                    // 424\n      this._fields.push(new Field(field));                                                                     // 425\n    }                                                                                                          // 426\n                                                                                                               // 427\n    return this._fields;                                                                                       // 428\n};                                                                                                             // 429\n                                                                                                               // 430\nAT.prototype.addFields = function(fields) {                                                                    // 431\n  var ok;                                                                                                      // 432\n                                                                                                               // 433\n  try { // don\"t bother with `typeof` - just access `length` and `catch`                                       // 434\n    ok = fields.length > 0 && \"0\" in Object(fields);                                                           // 435\n  } catch (e) {                                                                                                // 436\n    throw new Error(\"field argument should be an array of valid field objects!\");                              // 437\n  }                                                                                                            // 438\n  if (ok) {                                                                                                    // 439\n    _.map(fields, function(field) {                                                                            // 440\n      this.addField(field);                                                                                    // 441\n    }, this);                                                                                                  // 442\n  } else {                                                                                                     // 443\n    throw new Error(\"field argument should be an array of valid field objects!\");                              // 444\n  }                                                                                                            // 445\n                                                                                                               // 446\n  return this._fields;                                                                                         // 447\n};                                                                                                             // 448\n                                                                                                               // 449\nAT.prototype.configure = function(config) {                                                                    // 450\n  // Configuration options can be set only before initialization                                               // 451\n  if (this._initialized) {                                                                                     // 452\n    throw new Error(\"Configuration options must be set before AccountsTemplates.init!\");                       // 453\n  }                                                                                                            // 454\n                                                                                                               // 455\n  // Updates the current configuration                                                                         // 456\n  check(config, CONFIG_PAT);                                                                                   // 457\n  var options = _.omit(config, \"texts\", \"reCaptcha\");                                                          // 458\n  this.options = _.defaults(options, this.options);                                                            // 459\n                                                                                                               // 460\n  // Possibly sets up reCaptcha options                                                                        // 461\n  var reCaptcha = config.reCaptcha;                                                                            // 462\n  if (reCaptcha) {                                                                                             // 463\n    // Updates the current button object                                                                       // 464\n    this.options.reCaptcha = _.defaults(reCaptcha, this.options.reCaptcha || {});                              // 465\n  }                                                                                                            // 466\n                                                                                                               // 467\n  // Possibly sets up texts...                                                                                 // 468\n  if (config.texts) {                                                                                          // 469\n    var texts = config.texts;                                                                                  // 470\n    var simpleTexts = _.omit(texts, \"button\", \"errors\", \"info\", \"inputIcons\", \"socialIcons\", \"title\");         // 471\n                                                                                                               // 472\n    this.texts = _.defaults(simpleTexts, this.texts);                                                          // 473\n                                                                                                               // 474\n    if (texts.button) {                                                                                        // 475\n      // Updates the current button object                                                                     // 476\n      this.texts.button = _.defaults(texts.button, this.texts.button);                                         // 477\n    }                                                                                                          // 478\n                                                                                                               // 479\n    if (texts.errors) {                                                                                        // 480\n      // Updates the current errors object                                                                     // 481\n      this.texts.errors = _.defaults(texts.errors, this.texts.errors);                                         // 482\n    }                                                                                                          // 483\n                                                                                                               // 484\n    if (texts.info) {                                                                                          // 485\n      // Updates the current info object                                                                       // 486\n      this.texts.info = _.defaults(texts.info, this.texts.info);                                               // 487\n    }                                                                                                          // 488\n                                                                                                               // 489\n    if (texts.inputIcons) {                                                                                    // 490\n      // Updates the current inputIcons object                                                                 // 491\n      this.texts.inputIcons = _.defaults(texts.inputIcons, this.texts.inputIcons);                             // 492\n    }                                                                                                          // 493\n                                                                                                               // 494\n    if (texts.socialIcons) {                                                                                   // 495\n      // Updates the current socialIcons object                                                                // 496\n      this.texts.socialIcons = _.defaults(texts.socialIcons, this.texts.socialIcons);                          // 497\n    }                                                                                                          // 498\n                                                                                                               // 499\n    if (texts.title) {                                                                                         // 500\n      // Updates the current title object                                                                      // 501\n      this.texts.title = _.defaults(texts.title, this.texts.title);                                            // 502\n    }                                                                                                          // 503\n  }                                                                                                            // 504\n};                                                                                                             // 505\n                                                                                                               // 506\n                                                                                                               // 507\nAT.prototype.configureRoute = function(route, options) {                                                       // 508\n  console.warn('You now need a routing package like useraccounts:iron-routing or useraccounts:flow-routing to be able to configure routes!');\n};                                                                                                             // 510\n                                                                                                               // 511\n                                                                                                               // 512\nAT.prototype.hasField = function(fieldId) {                                                                    // 513\n  return !!this.getField(fieldId);                                                                             // 514\n};                                                                                                             // 515\n                                                                                                               // 516\nAT.prototype.getField = function(fieldId) {                                                                    // 517\n  var field = _.filter(this._fields, function(field) {                                                         // 518\n    return field._id === fieldId;                                                                              // 519\n  });                                                                                                          // 520\n                                                                                                               // 521\n  return (field.length === 1) ? field[0] : undefined;                                                          // 522\n};                                                                                                             // 523\n                                                                                                               // 524\nAT.prototype.getFields = function() {                                                                          // 525\n    return this._fields;                                                                                       // 526\n};                                                                                                             // 527\n                                                                                                               // 528\nAT.prototype.getFieldIds = function() {                                                                        // 529\n    return _.pluck(this._fields, \"_id\");                                                                       // 530\n};                                                                                                             // 531\n                                                                                                               // 532\nAT.prototype.getRoutePath = function(route) {                                                                  // 533\n    return \"#\";                                                                                                // 534\n};                                                                                                             // 535\n                                                                                                               // 536\nAT.prototype.oauthServices = function() {                                                                      // 537\n  // Extracts names of available services                                                                      // 538\n  var names;                                                                                                   // 539\n                                                                                                               // 540\n  if (Meteor.isServer) {                                                                                       // 541\n    names = (Accounts.oauth && Accounts.oauth.serviceNames()) || [];                                           // 542\n  } else {                                                                                                     // 543\n    names = (Accounts.oauth && Accounts.loginServicesConfigured() && Accounts.oauth.serviceNames()) || [];     // 544\n  }                                                                                                            // 545\n  // Extracts names of configured services                                                                     // 546\n  var configuredServices = [];                                                                                 // 547\n                                                                                                               // 548\n  if (Accounts.loginServiceConfiguration) {                                                                    // 549\n    configuredServices = _.pluck(Accounts.loginServiceConfiguration.find().fetch(), \"service\");                // 550\n  }                                                                                                            // 551\n                                                                                                               // 552\n  // Builds a list of objects containing service name as _id and its configuration status                      // 553\n  var services = _.map(names, function(name) {                                                                 // 554\n    return {                                                                                                   // 555\n      _id : name,                                                                                              // 556\n      configured: _.contains(configuredServices, name),                                                        // 557\n    };                                                                                                         // 558\n  });                                                                                                          // 559\n                                                                                                               // 560\n  // Checks whether there is a UI to configure services...                                                     // 561\n  // XXX: this only works with the accounts-ui package                                                         // 562\n  var showUnconfigured = typeof Accounts._loginButtonsSession !== \"undefined\";                                 // 563\n                                                                                                               // 564\n  // Filters out unconfigured services in case they\"re not to be displayed                                     // 565\n  if (!showUnconfigured) {                                                                                     // 566\n    services = _.filter(services, function(service) {                                                          // 567\n      return service.configured;                                                                               // 568\n    });                                                                                                        // 569\n  }                                                                                                            // 570\n                                                                                                               // 571\n  // Sorts services by name                                                                                    // 572\n  services = _.sortBy(services, function(service) {                                                            // 573\n    return service._id;                                                                                        // 574\n  });                                                                                                          // 575\n                                                                                                               // 576\n  return services;                                                                                             // 577\n};                                                                                                             // 578\n                                                                                                               // 579\nAT.prototype.removeField = function(fieldId) {                                                                 // 580\n  // Fields can be removed only before initialization                                                          // 581\n  if (this._initialized) {                                                                                     // 582\n    throw new Error(\"AccountsTemplates.removeField should strictly be called before AccountsTemplates.init!\");\n  }                                                                                                            // 584\n  // Tries to look up the field with given _id                                                                 // 585\n  var index = _.indexOf(_.pluck(this._fields, \"_id\"), fieldId);                                                // 586\n                                                                                                               // 587\n  if (index !== -1) {                                                                                          // 588\n    return this._fields.splice(index, 1)[0];                                                                   // 589\n  } else if (!(Meteor.isServer && _.contains(this.SPECIAL_FIELDS, fieldId))) {                                 // 590\n    throw new Error(\"A field called \" + fieldId + \" does not exist!\");                                         // 591\n  }                                                                                                            // 592\n};                                                                                                             // 593\n                                                                                                               // 594\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// packages/useraccounts_core/lib/server.js                                                                    //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\n/* global                                                                                                      // 1\n  AT: false,                                                                                                   // 2\n  AccountsTemplates: false                                                                                     // 3\n*/                                                                                                             // 4\n\"use strict\";                                                                                                  // 5\n                                                                                                               // 6\n// Initialization                                                                                              // 7\nAT.prototype.init = function() {                                                                               // 8\n  console.warn(\"[AccountsTemplates] There is no more need to call AccountsTemplates.init()! Simply remove the call ;-)\");\n};                                                                                                             // 10\n                                                                                                               // 11\nAT.prototype._init = function() {                                                                              // 12\n  if (this._initialized) {                                                                                     // 13\n    return;                                                                                                    // 14\n  }                                                                                                            // 15\n                                                                                                               // 16\n  // Checks there is at least one account service installed                                                    // 17\n  if (!Package[\"accounts-password\"] && (!Accounts.oauth || Accounts.oauth.serviceNames().length === 0)) {      // 18\n    throw Error(\"AccountsTemplates: You must add at least one account service!\");                              // 19\n  }                                                                                                            // 20\n                                                                                                               // 21\n  // A password field is strictly required                                                                     // 22\n  var password = this.getField(\"password\");                                                                    // 23\n  if (!password) {                                                                                             // 24\n    throw Error(\"A password field is strictly required!\");                                                     // 25\n  }                                                                                                            // 26\n                                                                                                               // 27\n  if (password.type !== \"password\") {                                                                          // 28\n    throw Error(\"The type of password field should be password!\");                                             // 29\n  }                                                                                                            // 30\n                                                                                                               // 31\n  // Then we can have \"username\" or \"email\" or even both of them                                               // 32\n  // but at least one of the two is strictly required                                                          // 33\n  var username = this.getField(\"username\");                                                                    // 34\n  var email = this.getField(\"email\");                                                                          // 35\n                                                                                                               // 36\n  if (!username && !email) {                                                                                   // 37\n    throw Error(\"At least one field out of username and email is strictly required!\");                         // 38\n  }                                                                                                            // 39\n                                                                                                               // 40\n  if (username && !username.required) {                                                                        // 41\n    throw Error(\"The username field should be required!\");                                                     // 42\n  }                                                                                                            // 43\n                                                                                                               // 44\n  if (email) {                                                                                                 // 45\n    if (email.type !== \"email\") {                                                                              // 46\n      throw Error(\"The type of email field should be email!\");                                                 // 47\n    }                                                                                                          // 48\n                                                                                                               // 49\n    if (username) {                                                                                            // 50\n      // username and email                                                                                    // 51\n      if (username.type !== \"text\") {                                                                          // 52\n        throw Error(\"The type of username field should be text when email field is present!\");                 // 53\n      }                                                                                                        // 54\n    } else {                                                                                                   // 55\n      // email only                                                                                            // 56\n      if (!email.required) {                                                                                   // 57\n        throw Error(\"The email field should be required when username is not present!\");                       // 58\n      }                                                                                                        // 59\n    }                                                                                                          // 60\n  } else {                                                                                                     // 61\n    // username only                                                                                           // 62\n    if (username.type !== \"text\" && username.type !== \"tel\") {                                                 // 63\n      throw Error(\"The type of username field should be text or tel!\");                                        // 64\n    }                                                                                                          // 65\n  }                                                                                                            // 66\n                                                                                                               // 67\n  // Possibly publish more user data in order to be able to show add/remove                                    // 68\n  // buttons for 3rd-party services                                                                            // 69\n  if (this.options.showAddRemoveServices) {                                                                    // 70\n    // Publish additional current user info to get the list of registered services                             // 71\n    // XXX TODO: use                                                                                           // 72\n    // Accounts.addAutopublishFields({                                                                         // 73\n    //   forLoggedInUser: ['services.facebook'],                                                               // 74\n    //   forOtherUsers: [],                                                                                    // 75\n    // })                                                                                                      // 76\n    // ...adds only user.services.*.id                                                                         // 77\n    Meteor.publish(\"userRegisteredServices\", function() {                                                      // 78\n      var userId = this.userId;                                                                                // 79\n      return Meteor.users.find(userId, {fields: {services: 1}});                                               // 80\n      /*                                                                                                       // 81\n      if (userId) {                                                                                            // 82\n        var user = Meteor.users.findOne(userId);                                                               // 83\n        var services_id = _.chain(user.services)                                                               // 84\n          .keys()                                                                                              // 85\n          .reject(function(service) {return service === \"resume\";})                                            // 86\n          .map(function(service) {return \"services.\" + service + \".id\";})                                      // 87\n          .value();                                                                                            // 88\n        var projection = {};                                                                                   // 89\n        _.each(services_id, function(key) {projection[key] = 1;});                                             // 90\n        return Meteor.users.find(userId, {fields: projection});                                                // 91\n      }                                                                                                        // 92\n      */                                                                                                       // 93\n    });                                                                                                        // 94\n  }                                                                                                            // 95\n                                                                                                               // 96\n  // Security stuff                                                                                            // 97\n  if (this.options.overrideLoginErrors) {                                                                      // 98\n    Accounts.validateLoginAttempt(function(attempt) {                                                          // 99\n      if (attempt.error) {                                                                                     // 100\n        var reason = attempt.error.reason;                                                                     // 101\n        if (reason === \"User not found\" || reason === \"Incorrect password\") {                                  // 102\n          throw new Meteor.Error(403, AccountsTemplates.texts.errors.loginForbidden);                          // 103\n        }                                                                                                      // 104\n      }                                                                                                        // 105\n      return attempt.allowed;                                                                                  // 106\n    });                                                                                                        // 107\n  }                                                                                                            // 108\n                                                                                                               // 109\n  if (this.options.sendVerificationEmail && this.options.enforceEmailVerification) {                           // 110\n    Accounts.validateLoginAttempt(function(attempt) {                                                          // 111\n      if (!attempt.allowed) {                                                                                  // 112\n        return false;                                                                                          // 113\n      }                                                                                                        // 114\n                                                                                                               // 115\n      if (attempt.type !== \"password\" || attempt.methodName !== \"login\") {                                     // 116\n        return attempt.allowed;                                                                                // 117\n      }                                                                                                        // 118\n                                                                                                               // 119\n      var user = attempt.user;                                                                                 // 120\n      if (!user) {                                                                                             // 121\n        return attempt.allowed;                                                                                // 122\n      }                                                                                                        // 123\n                                                                                                               // 124\n      var ok = true;                                                                                           // 125\n      var loginEmail = attempt.methodArguments[0].user.email;                                                  // 126\n      if (loginEmail) {                                                                                        // 127\n        var email = _.filter(user.emails, function(obj) {                                                      // 128\n          return obj.address === loginEmail;                                                                   // 129\n        });                                                                                                    // 130\n        if (!email.length || !email[0].verified) {                                                             // 131\n          ok = false;                                                                                          // 132\n        }                                                                                                      // 133\n      } else {                                                                                                 // 134\n        // we got the username, lets check there's at lease one verified email                                 // 135\n        var emailVerified = _.chain(user.emails)                                                               // 136\n        .pluck('verified')                                                                                     // 137\n        .any()                                                                                                 // 138\n        .value();                                                                                              // 139\n                                                                                                               // 140\n        if (!emailVerified) {                                                                                  // 141\n          ok = false;                                                                                          // 142\n        }                                                                                                      // 143\n      }                                                                                                        // 144\n      if (!ok) {                                                                                               // 145\n        throw new Meteor.Error(401, AccountsTemplates.texts.errors.verifyEmailFirst);                          // 146\n      }                                                                                                        // 147\n                                                                                                               // 148\n      return attempt.allowed;                                                                                  // 149\n    });                                                                                                        // 150\n  }                                                                                                            // 151\n                                                                                                               // 152\n  //Check that reCaptcha secret keys are available                                                             // 153\n  if (this.options.showReCaptcha) {                                                                            // 154\n    var atSecretKey = AccountsTemplates.options.reCaptcha && AccountsTemplates.options.reCaptcha.secretKey;    // 155\n    var settingsSecretKey = Meteor.settings.reCaptcha && Meteor.settings.reCaptcha.secretKey;                  // 156\n                                                                                                               // 157\n    if (!atSecretKey && !settingsSecretKey) {                                                                  // 158\n      throw new Meteor.Error(401, \"User Accounts: reCaptcha secret key not found! Please provide it or set showReCaptcha to false.\" );\n    }                                                                                                          // 160\n  }                                                                                                            // 161\n                                                                                                               // 162\n  // Marks AccountsTemplates as initialized                                                                    // 163\n  this._initialized = true;                                                                                    // 164\n};                                                                                                             // 165\n                                                                                                               // 166\nAccountsTemplates = new AT();                                                                                  // 167\n                                                                                                               // 168\n// Client side account creation is disabled by default:                                                        // 169\n// the methos ATCreateUserServer is used instead!                                                              // 170\n// to actually disable client side account creation use:                                                       // 171\n//                                                                                                             // 172\n//    AccountsTemplates.config({                                                                               // 173\n//        forbidClientAccountCreation: true                                                                    // 174\n//    });                                                                                                      // 175\n                                                                                                               // 176\nAccounts.config({                                                                                              // 177\n  forbidClientAccountCreation: true                                                                            // 178\n});                                                                                                            // 179\n                                                                                                               // 180\n// Initialization                                                                                              // 181\nMeteor.startup(function() {                                                                                    // 182\n  AccountsTemplates._init();                                                                                   // 183\n});                                                                                                            // 184\n                                                                                                               // 185\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// packages/useraccounts_core/lib/methods.js                                                                   //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\n/* global                                                                                                      // 1\n  AccountsTemplates: false                                                                                     // 2\n*/                                                                                                             // 3\n\"use strict\";                                                                                                  // 4\n                                                                                                               // 5\nMeteor.methods({                                                                                               // 6\n  ATRemoveService: function(serviceName) {                                                                     // 7\n    check(serviceName, String);                                                                                // 8\n                                                                                                               // 9\n    var userId = this.userId;                                                                                  // 10\n                                                                                                               // 11\n    if (userId) {                                                                                              // 12\n      var user = Meteor.users.findOne(userId);                                                                 // 13\n      var numServices = _.keys(user.services).length; // including \"resume\"                                    // 14\n      var unset = {};                                                                                          // 15\n                                                                                                               // 16\n      if (numServices === 2) {                                                                                 // 17\n        throw new Meteor.Error(403, AccountsTemplates.texts.errors.cannotRemoveService, {});                   // 18\n      }                                                                                                        // 19\n                                                                                                               // 20\n      unset[\"services.\" + serviceName] = \"\";                                                                   // 21\n      Meteor.users.update(userId, {$unset: unset});                                                            // 22\n    }                                                                                                          // 23\n  },                                                                                                           // 24\n});                                                                                                            // 25\n                                                                                                               // 26\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                             //\n// packages/useraccounts_core/lib/server_methods.js                                                            //\n//                                                                                                             //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                               //\n/* global                                                                                                      // 1\n  AccountsTemplates                                                                                            // 2\n*/                                                                                                             // 3\n\"use strict\";                                                                                                  // 4\n                                                                                                               // 5\nMeteor.methods({                                                                                               // 6\n  ATCreateUserServer: function(options) {                                                                      // 7\n    if (AccountsTemplates.options.forbidClientAccountCreation) {                                               // 8\n      throw new Meteor.Error(403, AccountsTemplates.texts.errors.accountsCreationDisabled);                    // 9\n    }                                                                                                          // 10\n                                                                                                               // 11\n    // createUser() does more checking.                                                                        // 12\n    check(options, Object);                                                                                    // 13\n    var allFieldIds = AccountsTemplates.getFieldIds();                                                         // 14\n                                                                                                               // 15\n    // Picks-up whitelisted fields for profile                                                                 // 16\n    var profile = options.profile;                                                                             // 17\n    profile = _.pick(profile, allFieldIds);                                                                    // 18\n    profile = _.omit(profile, \"username\", \"email\", \"password\");                                                // 19\n                                                                                                               // 20\n    // Validates fields\" value                                                                                 // 21\n    var signupInfo = _.clone(profile);                                                                         // 22\n    if (options.username) {                                                                                    // 23\n      signupInfo.username = options.username;                                                                  // 24\n                                                                                                               // 25\n      if (AccountsTemplates.options.lowercaseUsername) {                                                       // 26\n        signupInfo.username = signupInfo.username.trim().replace(/\\s+/gm, ' ');                                // 27\n        options.profile.name = signupInfo.username;                                                            // 28\n        signupInfo.username = signupInfo.username.toLowerCase().replace(/\\s+/gm, '');                          // 29\n        options.username = signupInfo.username;                                                                // 30\n      }                                                                                                        // 31\n    }                                                                                                          // 32\n                                                                                                               // 33\n    if (options.email) {                                                                                       // 34\n      signupInfo.email = options.email;                                                                        // 35\n                                                                                                               // 36\n      if (AccountsTemplates.options.lowercaseUsername) {                                                       // 37\n        signupInfo.email = signupInfo.email.toLowerCase().replace(/\\s+/gm, '');                                // 38\n        options.email = signupInfo.email;                                                                      // 39\n      }                                                                                                        // 40\n    }                                                                                                          // 41\n                                                                                                               // 42\n    if (options.password) {                                                                                    // 43\n      signupInfo.password = options.password;                                                                  // 44\n    }                                                                                                          // 45\n                                                                                                               // 46\n    var validationErrors = {};                                                                                 // 47\n    var someError = false;                                                                                     // 48\n                                                                                                               // 49\n    // Validates fields values                                                                                 // 50\n    _.each(AccountsTemplates.getFields(), function(field) {                                                    // 51\n      var fieldId = field._id;                                                                                 // 52\n      var value = signupInfo[fieldId];                                                                         // 53\n                                                                                                               // 54\n      if (fieldId === \"password\") {                                                                            // 55\n        // Can\"t Pick-up password here                                                                         // 56\n        // NOTE: at this stage the password is already encripted,                                              // 57\n        //       so there is no way to validate it!!!                                                          // 58\n        check(value, Object);                                                                                  // 59\n        return;                                                                                                // 60\n      }                                                                                                        // 61\n                                                                                                               // 62\n      var validationErr = field.validate(value, \"strict\");                                                     // 63\n      if (validationErr) {                                                                                     // 64\n        validationErrors[fieldId] = validationErr;                                                             // 65\n        someError = true;                                                                                      // 66\n      }                                                                                                        // 67\n    });                                                                                                        // 68\n                                                                                                               // 69\n    if (AccountsTemplates.options.showReCaptcha) {                                                             // 70\n      var secretKey = null;                                                                                    // 71\n                                                                                                               // 72\n      if (AccountsTemplates.options.reCaptcha && AccountsTemplates.options.reCaptcha.secretKey) {              // 73\n        secretKey = AccountsTemplates.options.reCaptcha.secretKey;                                             // 74\n      } else {                                                                                                 // 75\n        secretKey = Meteor.settings.reCaptcha.secretKey;                                                       // 76\n      }                                                                                                        // 77\n                                                                                                               // 78\n      var apiResponse = HTTP.post(\"https://www.google.com/recaptcha/api/siteverify\", {                         // 79\n        params: {                                                                                              // 80\n          secret: secretKey,                                                                                   // 81\n          response: options.profile.reCaptchaResponse,                                                         // 82\n          remoteip: this.connection.clientAddress,                                                             // 83\n        }                                                                                                      // 84\n      }).data;                                                                                                 // 85\n                                                                                                               // 86\n      if (!apiResponse.success) {                                                                              // 87\n        throw new Meteor.Error(403, AccountsTemplates.texts.errors.captchaVerification,                        // 88\n          apiResponse['error-codes'] ? apiResponse['error-codes'].join(\", \") : \"Unknown Error.\");              // 89\n      }                                                                                                        // 90\n    }                                                                                                          // 91\n                                                                                                               // 92\n    if (someError) {                                                                                           // 93\n      throw new Meteor.Error(403, AccountsTemplates.texts.errors.validationErrors, validationErrors);          // 94\n    }                                                                                                          // 95\n                                                                                                               // 96\n    // Possibly removes the profile field                                                                      // 97\n    if (_.isEmpty(options.profile)) {                                                                          // 98\n      delete options.profile;                                                                                  // 99\n    }                                                                                                          // 100\n                                                                                                               // 101\n    // Create user. result contains id and token.                                                              // 102\n    var userId = Accounts.createUser(options);                                                                 // 103\n    // safety belt. createUser is supposed to throw on error. send 500 error                                   // 104\n    // instead of sending a verification email with empty userid.                                              // 105\n    if (! userId) {                                                                                            // 106\n      throw new Error(\"createUser failed to insert new user\");                                                 // 107\n    }                                                                                                          // 108\n                                                                                                               // 109\n    // Call postSignUpHook, if any...                                                                          // 110\n    var postSignUpHook = AccountsTemplates.options.postSignUpHook;                                             // 111\n    if (postSignUpHook) {                                                                                      // 112\n      postSignUpHook(userId, options);                                                                         // 113\n    }                                                                                                          // 114\n                                                                                                               // 115\n    // Send a email address verification email in case the context permits it                                  // 116\n    // and the specific configuration flag was set to true                                                     // 117\n    if (options.email && AccountsTemplates.options.sendVerificationEmail) {                                    // 118\n      Accounts.sendVerificationEmail(userId, options.email);                                                   // 119\n    }                                                                                                          // 120\n  },                                                                                                           // 121\n                                                                                                               // 122\n  // Resend a user's verification e-mail                                                                       // 123\n  ATResendVerificationEmail: function (email) {                                                                // 124\n    check(email, String);                                                                                      // 125\n                                                                                                               // 126\n    var user = Meteor.users.findOne({ \"emails.address\": email });                                              // 127\n                                                                                                               // 128\n    // Send the standard error back to the client if no user exist with this e-mail                            // 129\n    if (!user) {                                                                                               // 130\n      throw new Meteor.Error(403, \"User not found\");                                                           // 131\n    }                                                                                                          // 132\n                                                                                                               // 133\n    try {                                                                                                      // 134\n      Accounts.sendVerificationEmail(user._id);                                                                // 135\n    } catch (error) {                                                                                          // 136\n      // Handle error when email already verified                                                              // 137\n      // https://github.com/dwinston/send-verification-email-bug                                               // 138\n      throw new Meteor.Error(403, \"Already verified\");                                                         // 139\n    }                                                                                                          // 140\n  },                                                                                                           // 141\n});                                                                                                            // 142\n                                                                                                               // 143\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nif (typeof Package === 'undefined') Package = {};\nPackage['useraccounts:core'] = {\n  AccountsTemplates: AccountsTemplates\n};\n\n})();\n","servePath":"/packages/useraccounts_core.js","sourceMap":{"version":3,"sources":["/packages/useraccounts_core/lib/field.js","/packages/useraccounts_core/lib/core.js","/packages/useraccounts_core/lib/server.js","/packages/useraccounts_core/lib/methods.js","/packages/useraccounts_core/lib/server_methods.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qH;;;;;;;;;;;;;;;;;;ACpSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qH;;;;;;;;;;;;;;;;;;ACjlBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qH;;;;;;;;;;;;;;;;;;ACxLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oH;;;;;;;;;;;;;;;;;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qH","file":"/packages/useraccounts_core.js","sourcesContent":["// ---------------------------------------------------------------------------------\n// Field object\n// ---------------------------------------------------------------------------------\n\nField = function(field) {\n  check(field, FIELD_PAT);\n  _.defaults(this, field);\n\n  this.validating = new ReactiveVar(false);\n  this.status = new ReactiveVar(null);\n};\n\nif (Meteor.isClient) {\n  Field.prototype.clearStatus = function() {\n    return this.status.set(null);\n  };\n}\n\nif (Meteor.isServer) {\n  Field.prototype.clearStatus = function() {\n    // Nothing to do server-side\n    return;\n  };\n}\n\nField.prototype.fixValue = function(value) {\n  if (this.type === \"checkbox\") {\n    return !!value;\n  }\n\n  if (this.type === \"select\") {\n    // TODO: something working...\n    return value;\n  }\n\n  if (this.type === \"radio\") {\n    // TODO: something working...\n    return value;\n  }\n\n  // Possibly applies required transformations to the input value\n  if (this.trim) {\n    value = value.trim();\n  }\n\n  if (this.lowercase) {\n    value = value.toLowerCase();\n  }\n\n  if (this.uppercase) {\n    value = value.toUpperCase();\n  }\n\n  if (!!this.transform) {\n    value = this.transform(value);\n  }\n\n  return value;\n};\n\nif (Meteor.isClient) {\n  Field.prototype.getDisplayName = function(state) {\n    var displayName = this.displayName;\n\n    if (_.isFunction(displayName)) {\n      displayName = displayName();\n    } else if (_.isObject(displayName)) {\n      displayName = displayName[state] || displayName[\"default\"];\n    }\n\n    if (!displayName) {\n      displayName = capitalize(this._id);\n    }\n\n    return displayName;\n  };\n}\n\nif (Meteor.isClient) {\n  Field.prototype.getPlaceholder = function(state) {\n    var placeholder = this.placeholder;\n\n    if (_.isObject(placeholder)) {\n      placeholder = placeholder[state] || placeholder[\"default\"];\n    }\n\n    if (!placeholder) {\n      placeholder = capitalize(this._id);\n    }\n\n    return placeholder;\n  };\n}\n\nField.prototype.getStatus = function() {\n  return this.status.get();\n};\n\nif (Meteor.isClient) {\n  Field.prototype.getValue = function(tempalteInstance) {\n    if (this.type === \"checkbox\") {\n      return !!(tempalteInstance.$(\"#at-field-\" + this._id + \":checked\").val());\n    }\n\n    if (this.type === \"radio\") {\n      return tempalteInstance.$(\"[name=at-field-\"+ this._id + \"]:checked\").val();\n    }\n\n    return tempalteInstance.$(\"#at-field-\" + this._id).val();\n  };\n}\n\nif (Meteor.isClient) {\n  Field.prototype.hasError = function() {\n    return this.negativeValidation && this.status.get();\n  };\n}\n\nif (Meteor.isClient) {\n  Field.prototype.hasIcon = function() {\n    if (this.showValidating && this.isValidating()) {\n      return true;\n    }\n\n    if (this.negativeFeedback && this.hasError()) {\n      return true;\n    }\n\n    if (this.positiveFeedback && this.hasSuccess()) {\n      return true;\n    }\n  };\n}\n\nif (Meteor.isClient) {\n  Field.prototype.hasSuccess = function() {\n    return this.positiveValidation && this.status.get() === false;\n  };\n}\n\nif (Meteor.isClient)\n  Field.prototype.iconClass = function() {\n    if (this.isValidating()) {\n      return AccountsTemplates.texts.inputIcons[\"isValidating\"];\n    }\n\n    if (this.hasError()) {\n      return AccountsTemplates.texts.inputIcons[\"hasError\"];\n    }\n\n    if (this.hasSuccess()) {\n      return AccountsTemplates.texts.inputIcons[\"hasSuccess\"];\n    }\n  };\n\nif (Meteor.isClient) {\n  Field.prototype.isValidating = function() {\n    return this.validating.get();\n  };\n}\n\nif (Meteor.isClient) {\n  Field.prototype.setError = function(err) {\n    check(err, Match.OneOf(String, undefined, Boolean));\n\n    if (err === false) {\n      return this.status.set(false);\n    }\n\n    return this.status.set(err || true);\n  };\n}\n\nif (Meteor.isServer) {\n  Field.prototype.setError = function(err) {\n    // Nothing to do server-side\n    return;\n  };\n}\n\nif (Meteor.isClient) {\n  Field.prototype.setSuccess = function() {\n    return this.status.set(false);\n  };\n}\n\nif (Meteor.isServer) {\n  Field.prototype.setSuccess = function() {\n    // Nothing to do server-side\n    return;\n  };\n}\n\nif (Meteor.isClient) {\n  Field.prototype.setValidating = function(state) {\n    check(state, Boolean);\n    return this.validating.set(state);\n  };\n}\n\nif (Meteor.isServer) {\n  Field.prototype.setValidating = function(state) {\n    // Nothing to do server-side\n    return;\n  };\n}\n\nif (Meteor.isClient) {\n  Field.prototype.setValue = function(tempalteInstance, value) {\n    if (this.type === \"checkbox\") {\n      tempalteInstance.$(\"#at-field-\" + this._id).prop('checked', true);\n      return;\n    }\n\n    if (this.type === \"radio\") {\n      tempalteInstance.$(\"[name=at-field-\"+ this._id + \"]\").prop('checked', true);\n      return;\n    }\n\n    tempalteInstance.$(\"#at-field-\" + this._id).val(value);\n  };\n}\n\nField.prototype.validate = function(value, strict) {\n  check(value, Match.OneOf(undefined, String, Boolean));\n  this.setValidating(true);\n  this.clearStatus();\n\n  if (_.isUndefined(value) || value === '') {\n    if (!!strict) {\n      if (this.required) {\n        this.setError(AccountsTemplates.texts.requiredField);\n        this.setValidating(false);\n\n        return AccountsTemplates.texts.requiredField;\n      } else {\n        this.setSuccess();\n        this.setValidating(false);\n\n        return false;\n      }\n    } else {\n      this.clearStatus();\n      this.setValidating(false);\n\n      return null;\n    }\n  }\n\n  var valueLength = value.length;\n  var minLength = this.minLength;\n  if (minLength && valueLength < minLength) {\n    this.setError(AccountsTemplates.texts.minRequiredLength + \": \" + minLength);\n    this.setValidating(false);\n\n    return AccountsTemplates.texts.minRequiredLength + \": \" + minLength;\n  }\n\n  var maxLength = this.maxLength;\n  if (maxLength && valueLength > maxLength) {\n    this.setError(AccountsTemplates.texts.maxAllowedLength + \": \" + maxLength);\n    this.setValidating(false);\n\n    return AccountsTemplates.texts.maxAllowedLength + \": \" + maxLength;\n  }\n\n  if (this.re && valueLength && !value.match(this.re)) {\n    this.setError(this.errStr);\n    this.setValidating(false);\n\n    return this.errStr;\n  }\n\n  if (this.func) {\n    var result = this.func(value);\n    var err = result === true ? this.errStr || true : result;\n\n    if (_.isUndefined(result)) {\n      return err;\n    }\n\n    this.status.set(err);\n    this.setValidating(false);\n\n    return err;\n  }\n\n  this.setSuccess();\n  this.setValidating(false);\n\n  return false;\n};\n","// ---------------------------------------------------------------------------------\n// Patterns for methods\" parameters\n// ---------------------------------------------------------------------------------\n\nSTATE_PAT = {\n  changePwd: Match.Optional(String),\n  enrollAccount: Match.Optional(String),\n  forgotPwd: Match.Optional(String),\n  resetPwd: Match.Optional(String),\n  signIn: Match.Optional(String),\n  signUp: Match.Optional(String),\n  verifyEmail: Match.Optional(String),\n  resendVerificationEmail: Match.Optional(String),\n};\n\nERRORS_PAT = {\n  accountsCreationDisabled: Match.Optional(String),\n  cannotRemoveService: Match.Optional(String),\n  captchaVerification: Match.Optional(String),\n  loginForbidden: Match.Optional(String),\n  mustBeLoggedIn: Match.Optional(String),\n  pwdMismatch: Match.Optional(String),\n  validationErrors: Match.Optional(String),\n  verifyEmailFirst: Match.Optional(String),\n};\n\nINFO_PAT = {\n  emailSent: Match.Optional(String),\n  emailVerified: Match.Optional(String),\n  pwdChanged: Match.Optional(String),\n  pwdReset: Match.Optional(String),\n  pwdSet: Match.Optional(String),\n  signUpVerifyEmail: Match.Optional(String),\n  verificationEmailSent: Match.Optional(String),\n};\n\nINPUT_ICONS_PAT = {\n  hasError: Match.Optional(String),\n  hasSuccess: Match.Optional(String),\n  isValidating: Match.Optional(String),\n};\n\nObjWithStringValues = Match.Where(function (x) {\n  check(x, Object);\n  _.each(_.values(x), function(value) {\n      check(value, String);\n  });\n  return true;\n});\n\nTEXTS_PAT = {\n  button: Match.Optional(STATE_PAT),\n  errors: Match.Optional(ERRORS_PAT),\n  info: Match.Optional(INFO_PAT),\n  inputIcons: Match.Optional(INPUT_ICONS_PAT),\n  maxAllowedLength: Match.Optional(String),\n  minRequiredLength: Match.Optional(String),\n  navSignIn: Match.Optional(String),\n  navSignOut: Match.Optional(String),\n  optionalField: Match.Optional(String),\n  pwdLink_link: Match.Optional(String),\n  pwdLink_pre: Match.Optional(String),\n  pwdLink_suff: Match.Optional(String),\n  requiredField: Match.Optional(String),\n  resendVerificationEmailLink_pre: Match.Optional(String),\n  resendVerificationEmailLink_link: Match.Optional(String),\n  resendVerificationEmailLink_suff: Match.Optional(String),\n  sep: Match.Optional(String),\n  signInLink_link: Match.Optional(String),\n  signInLink_pre: Match.Optional(String),\n  signInLink_suff: Match.Optional(String),\n  signUpLink_link: Match.Optional(String),\n  signUpLink_pre: Match.Optional(String),\n  signUpLink_suff: Match.Optional(String),\n  socialAdd: Match.Optional(String),\n  socialConfigure: Match.Optional(String),\n  socialIcons: Match.Optional(ObjWithStringValues),\n  socialRemove: Match.Optional(String),\n  socialSignIn: Match.Optional(String),\n  socialSignUp: Match.Optional(String),\n  socialWith: Match.Optional(String),\n  termsAnd: Match.Optional(String),\n  termsPreamble: Match.Optional(String),\n  termsPrivacy: Match.Optional(String),\n  termsTerms: Match.Optional(String),\n  title: Match.Optional(STATE_PAT),\n};\n\n// Configuration pattern to be checked with check\nCONFIG_PAT = {\n  // Behaviour\n  confirmPassword: Match.Optional(Boolean),\n  defaultState: Match.Optional(String),\n  enablePasswordChange: Match.Optional(Boolean),\n  enforceEmailVerification: Match.Optional(Boolean),\n  focusFirstInput: Match.Optional(Boolean),\n  forbidClientAccountCreation: Match.Optional(Boolean),\n  lowercaseUsername: Match.Optional(Boolean),\n  overrideLoginErrors: Match.Optional(Boolean),\n  sendVerificationEmail: Match.Optional(Boolean),\n  socialLoginStyle: Match.Optional(Match.OneOf(\"popup\", \"redirect\")),\n\n  // Appearance\n  defaultLayout: Match.Optional(String),\n  hideSignInLink: Match.Optional(Boolean),\n  hideSignUpLink: Match.Optional(Boolean),\n  showAddRemoveServices: Match.Optional(Boolean),\n  showForgotPasswordLink: Match.Optional(Boolean),\n  showResendVerificationEmailLink: Match.Optional(Boolean),\n  showLabels: Match.Optional(Boolean),\n  showPlaceholders: Match.Optional(Boolean),\n\n  // Client-side Validation\n  continuousValidation: Match.Optional(Boolean),\n  negativeFeedback: Match.Optional(Boolean),\n  negativeValidation: Match.Optional(Boolean),\n  positiveFeedback: Match.Optional(Boolean),\n  positiveValidation: Match.Optional(Boolean),\n  showValidating: Match.Optional(Boolean),\n\n  // Privacy Policy and Terms of Use\n  privacyUrl: Match.Optional(String),\n  termsUrl: Match.Optional(String),\n\n  // Redirects\n  homeRoutePath: Match.Optional(String),\n  redirectTimeout: Match.Optional(Number),\n\n  // Hooks\n  onLogoutHook: Match.Optional(Function),\n  onSubmitHook: Match.Optional(Function),\n  preSignUpHook: Match.Optional(Function),\n  postSignUpHook: Match.Optional(Function),\n\n  texts: Match.Optional(TEXTS_PAT),\n\n  //reCaptcha config\n  reCaptcha: Match.Optional({\n    data_type: Match.Optional(Match.OneOf(\"audio\", \"image\")),\n    secretKey: Match.Optional(String),\n    siteKey: Match.Optional(String),\n    theme: Match.Optional(Match.OneOf(\"dark\", \"light\")),\n  }),\n\n  showReCaptcha: Match.Optional(Boolean),\n};\n\n\nFIELD_SUB_PAT = {\n  \"default\": Match.Optional(String),\n  changePwd: Match.Optional(String),\n  enrollAccount: Match.Optional(String),\n  forgotPwd: Match.Optional(String),\n  resetPwd: Match.Optional(String),\n  signIn: Match.Optional(String),\n  signUp: Match.Optional(String),\n};\n\n\n// Field pattern\nFIELD_PAT = {\n  _id: String,\n  type: String,\n  required: Match.Optional(Boolean),\n  displayName: Match.Optional(Match.OneOf(String, Match.Where(_.isFunction), FIELD_SUB_PAT)),\n  placeholder: Match.Optional(Match.OneOf(String, FIELD_SUB_PAT)),\n  select: Match.Optional([{text: String, value: Match.Any}]),\n  minLength: Match.Optional(Match.Integer),\n  maxLength: Match.Optional(Match.Integer),\n  re: Match.Optional(RegExp),\n  func: Match.Optional(Match.Where(_.isFunction)),\n  errStr: Match.Optional(String),\n\n  // Client-side Validation\n  continuousValidation: Match.Optional(Boolean),\n  negativeFeedback: Match.Optional(Boolean),\n  negativeValidation: Match.Optional(Boolean),\n  positiveValidation: Match.Optional(Boolean),\n  positiveFeedback: Match.Optional(Boolean),\n\n  // Transforms\n  trim: Match.Optional(Boolean),\n  lowercase: Match.Optional(Boolean),\n  uppercase: Match.Optional(Boolean),\n  transform: Match.Optional(Match.Where(_.isFunction)),\n\n  // Custom options\n  options: Match.Optional(Object),\n  template: Match.Optional(String),\n};\n\n// -----------------------------------------------------------------------------\n// AccountsTemplates object\n// -----------------------------------------------------------------------------\n\n// -------------------\n// Client/Server stuff\n// -------------------\n\n// Constructor\nAT = function() {\n\n};\n\nAT.prototype.CONFIG_PAT = CONFIG_PAT;\n\n/*\n  Each field object is represented by the following properties:\n    _id:         String   (required)  // A unique field\"s id / name\n    type:        String   (required)  // Displayed input type\n    required:    Boolean  (optional)  // Specifies Whether to fail or not when field is left empty\n    displayName: String   (optional)  // The field\"s name to be displayed as a label above the input element\n    placeholder: String   (optional)  // The placeholder text to be displayed inside the input element\n    minLength:   Integer  (optional)  // Possibly specifies the minimum allowed length\n    maxLength:   Integer  (optional)  // Possibly specifies the maximum allowed length\n    re:          RegExp   (optional)  // Regular expression for validation\n    func:        Function (optional)  // Custom function for validation\n    errStr:      String   (optional)  // Error message to be displayed in case re validation fails\n*/\n\n\n// Allowed input types\nAT.prototype.INPUT_TYPES = [\n  \"checkbox\",\n  \"email\",\n  \"hidden\",\n  \"password\",\n  \"radio\",\n  \"select\",\n  \"tel\",\n  \"text\",\n  \"url\",\n];\n\n// Current configuration values\nAT.prototype.options = {\n  // Appearance\n  //defaultLayout: undefined,\n  showAddRemoveServices: false,\n  showForgotPasswordLink: false,\n  showResendVerificationEmailLink: false,\n  showLabels: true,\n  showPlaceholders: true,\n\n  // Behaviour\n  confirmPassword: true,\n  defaultState: \"signIn\",\n  enablePasswordChange: false,\n  focusFirstInput: !Meteor.isCordova,\n  forbidClientAccountCreation: false,\n  lowercaseUsername: false,\n  overrideLoginErrors: true,\n  sendVerificationEmail: false,\n  socialLoginStyle: \"popup\",\n\n  // Client-side Validation\n  //continuousValidation: false,\n  //negativeFeedback: false,\n  //negativeValidation: false,\n  //positiveValidation: false,\n  //positiveFeedback: false,\n  //showValidating: false,\n\n  // Privacy Policy and Terms of Use\n  privacyUrl: undefined,\n  termsUrl: undefined,\n\n  // Hooks\n  onSubmitHook: undefined,\n};\n\nAT.prototype.texts = {\n  button: {\n    changePwd: \"updateYourPassword\",\n    //enrollAccount: \"createAccount\",\n    enrollAccount: \"signUp\",\n    forgotPwd: \"emailResetLink\",\n    resetPwd: \"setPassword\",\n    signIn: \"signIn\",\n    signUp: \"signUp\",\n    resendVerificationEmail: \"Send email again\",\n  },\n  errors: {\n    accountsCreationDisabled: \"Client side accounts creation is disabled!!!\",\n    cannotRemoveService: \"Cannot remove the only active service!\",\n    captchaVerification: \"Captcha verification failed!\",\n    loginForbidden: \"error.accounts.Login forbidden\",\n    mustBeLoggedIn: \"error.accounts.Must be logged in\",\n    pwdMismatch: \"error.pwdsDontMatch\",\n    validationErrors: \"Validation Errors\",\n    verifyEmailFirst: \"Please verify your email first. Check the email and follow the link!\",\n  },\n  navSignIn: 'signIn',\n  navSignOut: 'signOut',\n  info: {\n    emailSent: \"info.emailSent\",\n    emailVerified: \"info.emailVerified\",\n    pwdChanged: \"info.passwordChanged\",\n    pwdReset: \"info.passwordReset\",\n    pwdSet: \"Password Set\",\n    signUpVerifyEmail: \"Successful Registration! Please check your email and follow the instructions.\",\n    verificationEmailSent: \"A new email has been sent to you. If the email doesn't show up in your inbox, be sure to check your spam folder.\",\n  },\n  inputIcons: {\n    isValidating: \"fa fa-spinner fa-spin\",\n    hasSuccess: \"fa fa-check\",\n    hasError: \"fa fa-times\",\n  },\n  maxAllowedLength: \"Maximum allowed length\",\n  minRequiredLength: \"Minimum required length\",\n  optionalField: \"optional\",\n  pwdLink_pre: \"\",\n  pwdLink_link: \"forgotPassword\",\n  pwdLink_suff: \"\",\n  requiredField: \"Required Field\",\n  resendVerificationEmailLink_pre: \"Verification email lost?\",\n  resendVerificationEmailLink_link: \"Send again\",\n  resendVerificationEmailLink_suff: \"\",\n  sep: \"OR\",\n  signInLink_pre: \"ifYouAlreadyHaveAnAccount\",\n  signInLink_link: \"signin\",\n  signInLink_suff: \"\",\n  signUpLink_pre: \"dontHaveAnAccount\",\n  signUpLink_link: \"signUp\",\n  signUpLink_suff: \"\",\n  socialAdd: \"add\",\n  socialConfigure: \"configure\",\n  socialIcons: {\n      \"meteor-developer\": \"fa fa-rocket\"\n  },\n  socialRemove: \"remove\",\n  socialSignIn: \"signIn\",\n  socialSignUp: \"signUp\",\n  socialWith: \"with\",\n  termsPreamble: \"clickAgree\",\n  termsPrivacy: \"privacyPolicy\",\n  termsAnd: \"and\",\n  termsTerms: \"terms\",\n  title: {\n    changePwd: \"changePassword\",\n    enrollAccount: \"createAccount\",\n    forgotPwd: \"resetYourPassword\",\n    resetPwd: \"resetYourPassword\",\n    signIn: \"signIn\",\n    signUp: \"createAccount\",\n    verifyEmail: \"\",\n    resendVerificationEmail: \"Send the verification email again\",\n  },\n};\n\nAT.prototype.SPECIAL_FIELDS = [\n  \"password_again\",\n  \"username_and_email\",\n];\n\n// SignIn / SignUp fields\nAT.prototype._fields = [\n  new Field({\n    _id: \"email\",\n    type: \"email\",\n    required: true,\n    lowercase: true,\n    trim: true,\n    func: function(email) {\n        return !_.contains(email, '@');\n    },\n    errStr: 'Invalid email',\n  }),\n  new Field({\n    _id: \"password\",\n    type: \"password\",\n    required: true,\n    minLength: 6,\n    displayName: {\n        \"default\": \"password\",\n        changePwd: \"newPassword\",\n        resetPwd: \"newPassword\",\n    },\n    placeholder: {\n        \"default\": \"password\",\n        changePwd: \"newPassword\",\n        resetPwd: \"newPassword\",\n    },\n  }),\n];\n\n\nAT.prototype._initialized = false;\n\n// Input type validation\nAT.prototype._isValidInputType = function(value) {\n    return _.indexOf(this.INPUT_TYPES, value) !== -1;\n};\n\nAT.prototype.addField = function(field) {\n    // Fields can be added only before initialization\n    if (this._initialized) {\n      throw new Error(\"AccountsTemplates.addField should strictly be called before AccountsTemplates.init!\");\n    }\n\n    field = _.pick(field, _.keys(FIELD_PAT));\n    check(field, FIELD_PAT);\n    // Checks there\"s currently no field called field._id\n    if (_.indexOf(_.pluck(this._fields, \"_id\"), field._id) !== -1) {\n      throw new Error(\"A field called \" + field._id + \" already exists!\");\n    }\n    // Validates field.type\n    if (!this._isValidInputType(field.type)) {\n      throw new Error(\"field.type is not valid!\");\n    }\n    // Checks field.minLength is strictly positive\n    if (typeof field.minLength !== \"undefined\" && field.minLength <= 0) {\n      throw new Error(\"field.minLength should be greater than zero!\");\n    }\n    // Checks field.maxLength is strictly positive\n    if (typeof field.maxLength !== \"undefined\" && field.maxLength <= 0) {\n      throw new Error(\"field.maxLength should be greater than zero!\");\n    }\n    // Checks field.maxLength is greater than field.minLength\n    if (typeof field.minLength !== \"undefined\" && typeof field.minLength !== \"undefined\" && field.maxLength < field.minLength) {\n      throw new Error(\"field.maxLength should be greater than field.maxLength!\");\n    }\n\n    if (!(Meteor.isServer && _.contains(this.SPECIAL_FIELDS, field._id))) {\n      this._fields.push(new Field(field));\n    }\n\n    return this._fields;\n};\n\nAT.prototype.addFields = function(fields) {\n  var ok;\n\n  try { // don\"t bother with `typeof` - just access `length` and `catch`\n    ok = fields.length > 0 && \"0\" in Object(fields);\n  } catch (e) {\n    throw new Error(\"field argument should be an array of valid field objects!\");\n  }\n  if (ok) {\n    _.map(fields, function(field) {\n      this.addField(field);\n    }, this);\n  } else {\n    throw new Error(\"field argument should be an array of valid field objects!\");\n  }\n\n  return this._fields;\n};\n\nAT.prototype.configure = function(config) {\n  // Configuration options can be set only before initialization\n  if (this._initialized) {\n    throw new Error(\"Configuration options must be set before AccountsTemplates.init!\");\n  }\n\n  // Updates the current configuration\n  check(config, CONFIG_PAT);\n  var options = _.omit(config, \"texts\", \"reCaptcha\");\n  this.options = _.defaults(options, this.options);\n\n  // Possibly sets up reCaptcha options\n  var reCaptcha = config.reCaptcha;\n  if (reCaptcha) {\n    // Updates the current button object\n    this.options.reCaptcha = _.defaults(reCaptcha, this.options.reCaptcha || {});\n  }\n\n  // Possibly sets up texts...\n  if (config.texts) {\n    var texts = config.texts;\n    var simpleTexts = _.omit(texts, \"button\", \"errors\", \"info\", \"inputIcons\", \"socialIcons\", \"title\");\n\n    this.texts = _.defaults(simpleTexts, this.texts);\n\n    if (texts.button) {\n      // Updates the current button object\n      this.texts.button = _.defaults(texts.button, this.texts.button);\n    }\n\n    if (texts.errors) {\n      // Updates the current errors object\n      this.texts.errors = _.defaults(texts.errors, this.texts.errors);\n    }\n\n    if (texts.info) {\n      // Updates the current info object\n      this.texts.info = _.defaults(texts.info, this.texts.info);\n    }\n\n    if (texts.inputIcons) {\n      // Updates the current inputIcons object\n      this.texts.inputIcons = _.defaults(texts.inputIcons, this.texts.inputIcons);\n    }\n\n    if (texts.socialIcons) {\n      // Updates the current socialIcons object\n      this.texts.socialIcons = _.defaults(texts.socialIcons, this.texts.socialIcons);\n    }\n\n    if (texts.title) {\n      // Updates the current title object\n      this.texts.title = _.defaults(texts.title, this.texts.title);\n    }\n  }\n};\n\n\nAT.prototype.configureRoute = function(route, options) {\n  console.warn('You now need a routing package like useraccounts:iron-routing or useraccounts:flow-routing to be able to configure routes!');\n};\n\n\nAT.prototype.hasField = function(fieldId) {\n  return !!this.getField(fieldId);\n};\n\nAT.prototype.getField = function(fieldId) {\n  var field = _.filter(this._fields, function(field) {\n    return field._id === fieldId;\n  });\n\n  return (field.length === 1) ? field[0] : undefined;\n};\n\nAT.prototype.getFields = function() {\n    return this._fields;\n};\n\nAT.prototype.getFieldIds = function() {\n    return _.pluck(this._fields, \"_id\");\n};\n\nAT.prototype.getRoutePath = function(route) {\n    return \"#\";\n};\n\nAT.prototype.oauthServices = function() {\n  // Extracts names of available services\n  var names;\n\n  if (Meteor.isServer) {\n    names = (Accounts.oauth && Accounts.oauth.serviceNames()) || [];\n  } else {\n    names = (Accounts.oauth && Accounts.loginServicesConfigured() && Accounts.oauth.serviceNames()) || [];\n  }\n  // Extracts names of configured services\n  var configuredServices = [];\n\n  if (Accounts.loginServiceConfiguration) {\n    configuredServices = _.pluck(Accounts.loginServiceConfiguration.find().fetch(), \"service\");\n  }\n\n  // Builds a list of objects containing service name as _id and its configuration status\n  var services = _.map(names, function(name) {\n    return {\n      _id : name,\n      configured: _.contains(configuredServices, name),\n    };\n  });\n\n  // Checks whether there is a UI to configure services...\n  // XXX: this only works with the accounts-ui package\n  var showUnconfigured = typeof Accounts._loginButtonsSession !== \"undefined\";\n\n  // Filters out unconfigured services in case they\"re not to be displayed\n  if (!showUnconfigured) {\n    services = _.filter(services, function(service) {\n      return service.configured;\n    });\n  }\n\n  // Sorts services by name\n  services = _.sortBy(services, function(service) {\n    return service._id;\n  });\n\n  return services;\n};\n\nAT.prototype.removeField = function(fieldId) {\n  // Fields can be removed only before initialization\n  if (this._initialized) {\n    throw new Error(\"AccountsTemplates.removeField should strictly be called before AccountsTemplates.init!\");\n  }\n  // Tries to look up the field with given _id\n  var index = _.indexOf(_.pluck(this._fields, \"_id\"), fieldId);\n\n  if (index !== -1) {\n    return this._fields.splice(index, 1)[0];\n  } else if (!(Meteor.isServer && _.contains(this.SPECIAL_FIELDS, fieldId))) {\n    throw new Error(\"A field called \" + fieldId + \" does not exist!\");\n  }\n};\n","/* global\n  AT: false,\n  AccountsTemplates: false\n*/\n\"use strict\";\n\n// Initialization\nAT.prototype.init = function() {\n  console.warn(\"[AccountsTemplates] There is no more need to call AccountsTemplates.init()! Simply remove the call ;-)\");\n};\n\nAT.prototype._init = function() {\n  if (this._initialized) {\n    return;\n  }\n\n  // Checks there is at least one account service installed\n  if (!Package[\"accounts-password\"] && (!Accounts.oauth || Accounts.oauth.serviceNames().length === 0)) {\n    throw Error(\"AccountsTemplates: You must add at least one account service!\");\n  }\n\n  // A password field is strictly required\n  var password = this.getField(\"password\");\n  if (!password) {\n    throw Error(\"A password field is strictly required!\");\n  }\n\n  if (password.type !== \"password\") {\n    throw Error(\"The type of password field should be password!\");\n  }\n\n  // Then we can have \"username\" or \"email\" or even both of them\n  // but at least one of the two is strictly required\n  var username = this.getField(\"username\");\n  var email = this.getField(\"email\");\n\n  if (!username && !email) {\n    throw Error(\"At least one field out of username and email is strictly required!\");\n  }\n\n  if (username && !username.required) {\n    throw Error(\"The username field should be required!\");\n  }\n\n  if (email) {\n    if (email.type !== \"email\") {\n      throw Error(\"The type of email field should be email!\");\n    }\n\n    if (username) {\n      // username and email\n      if (username.type !== \"text\") {\n        throw Error(\"The type of username field should be text when email field is present!\");\n      }\n    } else {\n      // email only\n      if (!email.required) {\n        throw Error(\"The email field should be required when username is not present!\");\n      }\n    }\n  } else {\n    // username only\n    if (username.type !== \"text\" && username.type !== \"tel\") {\n      throw Error(\"The type of username field should be text or tel!\");\n    }\n  }\n\n  // Possibly publish more user data in order to be able to show add/remove\n  // buttons for 3rd-party services\n  if (this.options.showAddRemoveServices) {\n    // Publish additional current user info to get the list of registered services\n    // XXX TODO: use\n    // Accounts.addAutopublishFields({\n    //   forLoggedInUser: ['services.facebook'],\n    //   forOtherUsers: [],\n    // })\n    // ...adds only user.services.*.id\n    Meteor.publish(\"userRegisteredServices\", function() {\n      var userId = this.userId;\n      return Meteor.users.find(userId, {fields: {services: 1}});\n      /*\n      if (userId) {\n        var user = Meteor.users.findOne(userId);\n        var services_id = _.chain(user.services)\n          .keys()\n          .reject(function(service) {return service === \"resume\";})\n          .map(function(service) {return \"services.\" + service + \".id\";})\n          .value();\n        var projection = {};\n        _.each(services_id, function(key) {projection[key] = 1;});\n        return Meteor.users.find(userId, {fields: projection});\n      }\n      */\n    });\n  }\n\n  // Security stuff\n  if (this.options.overrideLoginErrors) {\n    Accounts.validateLoginAttempt(function(attempt) {\n      if (attempt.error) {\n        var reason = attempt.error.reason;\n        if (reason === \"User not found\" || reason === \"Incorrect password\") {\n          throw new Meteor.Error(403, AccountsTemplates.texts.errors.loginForbidden);\n        }\n      }\n      return attempt.allowed;\n    });\n  }\n\n  if (this.options.sendVerificationEmail && this.options.enforceEmailVerification) {\n    Accounts.validateLoginAttempt(function(attempt) {\n      if (!attempt.allowed) {\n        return false;\n      }\n\n      if (attempt.type !== \"password\" || attempt.methodName !== \"login\") {\n        return attempt.allowed;\n      }\n\n      var user = attempt.user;\n      if (!user) {\n        return attempt.allowed;\n      }\n\n      var ok = true;\n      var loginEmail = attempt.methodArguments[0].user.email;\n      if (loginEmail) {\n        var email = _.filter(user.emails, function(obj) {\n          return obj.address === loginEmail;\n        });\n        if (!email.length || !email[0].verified) {\n          ok = false;\n        }\n      } else {\n        // we got the username, lets check there's at lease one verified email\n        var emailVerified = _.chain(user.emails)\n        .pluck('verified')\n        .any()\n        .value();\n\n        if (!emailVerified) {\n          ok = false;\n        }\n      }\n      if (!ok) {\n        throw new Meteor.Error(401, AccountsTemplates.texts.errors.verifyEmailFirst);\n      }\n\n      return attempt.allowed;\n    });\n  }\n\n  //Check that reCaptcha secret keys are available\n  if (this.options.showReCaptcha) {\n    var atSecretKey = AccountsTemplates.options.reCaptcha && AccountsTemplates.options.reCaptcha.secretKey;\n    var settingsSecretKey = Meteor.settings.reCaptcha && Meteor.settings.reCaptcha.secretKey;\n\n    if (!atSecretKey && !settingsSecretKey) {\n      throw new Meteor.Error(401, \"User Accounts: reCaptcha secret key not found! Please provide it or set showReCaptcha to false.\" );\n    }\n  }\n\n  // Marks AccountsTemplates as initialized\n  this._initialized = true;\n};\n\nAccountsTemplates = new AT();\n\n// Client side account creation is disabled by default:\n// the methos ATCreateUserServer is used instead!\n// to actually disable client side account creation use:\n//\n//    AccountsTemplates.config({\n//        forbidClientAccountCreation: true\n//    });\n\nAccounts.config({\n  forbidClientAccountCreation: true\n});\n\n// Initialization\nMeteor.startup(function() {\n  AccountsTemplates._init();\n});\n","/* global\n  AccountsTemplates: false\n*/\n\"use strict\";\n\nMeteor.methods({\n  ATRemoveService: function(serviceName) {\n    check(serviceName, String);\n\n    var userId = this.userId;\n\n    if (userId) {\n      var user = Meteor.users.findOne(userId);\n      var numServices = _.keys(user.services).length; // including \"resume\"\n      var unset = {};\n\n      if (numServices === 2) {\n        throw new Meteor.Error(403, AccountsTemplates.texts.errors.cannotRemoveService, {});\n      }\n\n      unset[\"services.\" + serviceName] = \"\";\n      Meteor.users.update(userId, {$unset: unset});\n    }\n  },\n});\n","/* global\n  AccountsTemplates\n*/\n\"use strict\";\n\nMeteor.methods({\n  ATCreateUserServer: function(options) {\n    if (AccountsTemplates.options.forbidClientAccountCreation) {\n      throw new Meteor.Error(403, AccountsTemplates.texts.errors.accountsCreationDisabled);\n    }\n\n    // createUser() does more checking.\n    check(options, Object);\n    var allFieldIds = AccountsTemplates.getFieldIds();\n\n    // Picks-up whitelisted fields for profile\n    var profile = options.profile;\n    profile = _.pick(profile, allFieldIds);\n    profile = _.omit(profile, \"username\", \"email\", \"password\");\n\n    // Validates fields\" value\n    var signupInfo = _.clone(profile);\n    if (options.username) {\n      signupInfo.username = options.username;\n\n      if (AccountsTemplates.options.lowercaseUsername) {\n        signupInfo.username = signupInfo.username.trim().replace(/\\s+/gm, ' ');\n        options.profile.name = signupInfo.username;\n        signupInfo.username = signupInfo.username.toLowerCase().replace(/\\s+/gm, '');\n        options.username = signupInfo.username;\n      }\n    }\n\n    if (options.email) {\n      signupInfo.email = options.email;\n\n      if (AccountsTemplates.options.lowercaseUsername) {\n        signupInfo.email = signupInfo.email.toLowerCase().replace(/\\s+/gm, '');\n        options.email = signupInfo.email;\n      }\n    }\n\n    if (options.password) {\n      signupInfo.password = options.password;\n    }\n\n    var validationErrors = {};\n    var someError = false;\n\n    // Validates fields values\n    _.each(AccountsTemplates.getFields(), function(field) {\n      var fieldId = field._id;\n      var value = signupInfo[fieldId];\n\n      if (fieldId === \"password\") {\n        // Can\"t Pick-up password here\n        // NOTE: at this stage the password is already encripted,\n        //       so there is no way to validate it!!!\n        check(value, Object);\n        return;\n      }\n\n      var validationErr = field.validate(value, \"strict\");\n      if (validationErr) {\n        validationErrors[fieldId] = validationErr;\n        someError = true;\n      }\n    });\n\n    if (AccountsTemplates.options.showReCaptcha) {\n      var secretKey = null;\n\n      if (AccountsTemplates.options.reCaptcha && AccountsTemplates.options.reCaptcha.secretKey) {\n        secretKey = AccountsTemplates.options.reCaptcha.secretKey;\n      } else {\n        secretKey = Meteor.settings.reCaptcha.secretKey;\n      }\n\n      var apiResponse = HTTP.post(\"https://www.google.com/recaptcha/api/siteverify\", {\n        params: {\n          secret: secretKey,\n          response: options.profile.reCaptchaResponse,\n          remoteip: this.connection.clientAddress,\n        }\n      }).data;\n\n      if (!apiResponse.success) {\n        throw new Meteor.Error(403, AccountsTemplates.texts.errors.captchaVerification,\n          apiResponse['error-codes'] ? apiResponse['error-codes'].join(\", \") : \"Unknown Error.\");\n      }\n    }\n\n    if (someError) {\n      throw new Meteor.Error(403, AccountsTemplates.texts.errors.validationErrors, validationErrors);\n    }\n\n    // Possibly removes the profile field\n    if (_.isEmpty(options.profile)) {\n      delete options.profile;\n    }\n\n    // Create user. result contains id and token.\n    var userId = Accounts.createUser(options);\n    // safety belt. createUser is supposed to throw on error. send 500 error\n    // instead of sending a verification email with empty userid.\n    if (! userId) {\n      throw new Error(\"createUser failed to insert new user\");\n    }\n\n    // Call postSignUpHook, if any...\n    var postSignUpHook = AccountsTemplates.options.postSignUpHook;\n    if (postSignUpHook) {\n      postSignUpHook(userId, options);\n    }\n\n    // Send a email address verification email in case the context permits it\n    // and the specific configuration flag was set to true\n    if (options.email && AccountsTemplates.options.sendVerificationEmail) {\n      Accounts.sendVerificationEmail(userId, options.email);\n    }\n  },\n\n  // Resend a user's verification e-mail\n  ATResendVerificationEmail: function (email) {\n    check(email, String);\n\n    var user = Meteor.users.findOne({ \"emails.address\": email });\n\n    // Send the standard error back to the client if no user exist with this e-mail\n    if (!user) {\n      throw new Meteor.Error(403, \"User not found\");\n    }\n\n    try {\n      Accounts.sendVerificationEmail(user._id);\n    } catch (error) {\n      // Handle error when email already verified\n      // https://github.com/dwinston/send-verification-email-bug\n      throw new Meteor.Error(403, \"Already verified\");\n    }\n  },\n});\n"]}}]